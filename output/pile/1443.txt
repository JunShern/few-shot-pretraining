{
    "criteria": [
        {
            "criterion": "AllDocuments",
            "passed": true,
            "reason": "All documents pass."
        },
        {
            "criterion": "Domain",
            "passed": false,
            "reason": "Document source unavailable."
        },
        {
            "criterion": "QuestionAnswerStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "QuestionAnswerStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "FullyStructured",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ListPrefix",
            "passed": false,
            "reason": "Found 0 list prefixes. (Min: 5)"
        },
        {
            "criterion": "ListPrefixV2",
            "passed": true,
            "reason": "Text contains ['-', '-', '-', '-', '-', '-', '-', '-', '-', '-', '1', '2', '-', '-', '-', '-', '-', '0', '-', '1', '2', '3', '1', '2', '3', '1', '2', '1', '2', '-', '-', '1', '2', '1', '2', '3', '4', '-', '1', '2', '-', '1', '2', '0', '-', '1', '2', '-', '-', '1', '2', '1', '2', '-', '1', '2', '1', '2', '-', '1', '2', '3']."
        },
        {
            "criterion": "ExamplesMinimalEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesSynonymsEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesDiverseEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        }
    ],
    "doc_id": "1443",
    "text": "---\nabstract: 'We study the fine scale $L^{2}$-mass distribution of toral Laplace eigenfunctions with respect to random position, in $2$ and $3$ dimensions. In $2$d, under certain flatness assumptions on the Fourier coefficients and generic restrictions on energy levels, both the asymptotic shape of the variance is determined and the limiting Gaussian law is established, in the optimal Planck-scale regime. In $3$d the asymptotic behaviour of the variance is analysed in a more restrictive scenario (\u201cBourgain\u2019s eigenfunctions\"). Other than the said precise results, lower and upper bounds are proved for the variance, under more general flatness assumptions on the Fourier coefficients.'\naddress:\n- |\n    IW: Department of Mathematics\\\n    King\u2019s College London\\\n    Strand\\\n    London WC2R 2LS\\\n    England, UK\n- |\n    NY: Department of Mathematics\\\n    King\u2019s College London\\\n    Strand\\\n    London WC2R 2LS\\\n    England, UK\nauthor:\n- Igor Wigman\n- Nadav Yesha\ntitle: CLT for Planck scale mass distribution of toral Laplace eigenfunctions\n---\n\nIntroduction\n============\n\nGiven a smooth compact $d$-manifold ${\\mathcal{M}}$ we are interested in the spectral properties of the Laplace-Beltrami operator $\\Delta$ on ${\\mathcal{M}}$. It is well-known that the eigenvalue spectrum of $\\Delta$ is purely discrete, i.e., the set of numbers $E$ admitting a solution to the Helmholtz equation $$\\Delta \\phi + E\\phi = 0$$ is a sequence $\\{E_{j}\\}_{j\\ge 1}$ of numbers ordered with multiplicity in a non-decreasing order such that $ E_j \\to \\infty $. We denote the corresponding sequence $\\{\\phi_{j} \\}_{j\\ge 1}$ of (real-valued) eigenfunctions constituting an orthonormal basis of the square-integrable functions $L^{2}({\\mathcal{M}})$ on ${\\mathcal{M}}$; the sequence $\\{\\phi_{j} \\}_{j\\ge 1}$ is uniquely determined up to the spectral degeneracies (i.e., up to orthogonal transformations in each eigenspace of dimension $\\ge 2$).\n\nShnirelman\u2019s Theorem and Small-Scale Equidistribution\n-----------------------------------------------------\n\nAssuming w.l.o.g. that ${\\mathcal{M}}$ is unit volume ${\\operatorname{Vol}}({\\mathcal{M}})=1$, the celebrated Shnirelman\u2019s Theorem \u00a0[@Sn; @Ze; @CdV] asserts that if ${\\mathcal{M}}$ is chaotic (i.e., the geodesic flow on $ \\mathcal{M} $ is ergodic), then \u201cmost\" of the $\\{\\phi_{j}\\}$ are $L^{2}$-equidistributed. In particular, they are equidistributed in position space, i.e., there exists a density $1$ sequence $j_{k}$ such that for all \u201cnice\" domains ${\\mathcal{A}}\\subseteq{\\mathcal{M}}$ we have $$\\label{eq:L2 mass phi->A/M}\n\\lim\\limits_{k\\rightarrow\\infty}\\int\\limits_{{\\mathcal{A}}}\\phi_{j_{k}}(x)^{2}dx= {\\operatorname{Vol}}({\\mathcal{A}}).$$ Beyond Shnirelman\u2019s Theorem, Berry\u2019s universality conjecture \u00a0[@Berry1; @Berry2] implies that for a [*generic*]{} chaotic manifold holds for ${\\mathcal{A}}$ shrinking with $k$, slower than the Planck\u2019s scale $E_{j_{k}}^{-1/2}$. More precisely, it states that there exists a density $1$ sequence $\\{j_{k}\\}_{k}$ so that if $r_{0}(E):{\\mathbb{R}}_{> 0}\\rightarrow{\\mathbb{R}}_{> 0}$ satisfies $r_{0}(E)\\cdot E^{1/2}\\rightarrow\\infty$ diverging arbitrarily slowly, then, for $B_{x}(r)$ the radius $r$ geodesic ball in ${\\mathcal{M}}$ centred at $x$, we have $$\\label{eq:|mass-exp|=o(r^d)}\n\\left|\\int\\limits_{B_{x}(r)}\\phi_{j_{k}}(y)^{2}dy - {\\operatorname{Vol}}(B_{x}(r)) \\right|\n= o_{k\\rightarrow\\infty} (r^{d})$$ uniformly for all $x\\in{\\mathcal{M}}$ and $r>r_{0}(E_{j_{k}})$, i.e., $$\\label{eq:L2mass shrinking uniform}\n\\sup\\limits_{\\substack{x\\in{\\mathcal{M}}\\\\ r>r_{0}(E_{j_{k}})}}\n\\left|\\frac{\\int\\limits_{B_{x}(r)}\\phi_{j_{k}}(y)^{2}dy}{{\\operatorname{Vol}}(B_{x}(r))} - 1\\right| \\rightarrow 0.$$\n\nThe following recent results are rigorous manifestations of the small-scale (\u201cshrinking balls\") statement . Luo and Sarnak \u00a0[@Luo-Sarnak Theorem 1.2] established the small-scale equidistribution for Laplace eigenfunctions on the modular surface (assuming in addition that they are Hecke eigenfunctions) where $r>E^{-\\alpha}$ with a small $ \\alpha>0 $, and Young [@Young], conditionally on GRH, refined this estimate for $r>E^{-1/6+o(1)}$ holding for *all* such eigenfunctions. Hezari and Rivi\u00e8re \u00a0[@Hezari-Riviere1], and independently Han \u00a0[@Han1] established the equidistribution for Laplace eigenfunctions on manifolds of negative curvature on logarithmic scale (i.e., $r>(\\log{E})^{-\\alpha}$, for some $\\alpha>0$), and Han \u00a0[@Han2] considered random Laplace eigenfunctions on \u201csymmetric\" manifolds, of high spectral degeneracy; here the higher the spectral degeneracy is the smaller the allowed scale is. More recently, Han and Tacy [@HanTacy] proved small-scale equidistribution for random Gaussian combinations of eigenfunctions on compact manifolds for $ r>E^{-1/2+o(1)} $, and de Courcy-Ireland [@DeCourcyIreland] showed that, with high probability, the $L^{2}$-mass of random Gaussian spherical harmonics is, up to a small error, equidistributed, slightly above Planck scale.\n\nToral Laplace eigenfunctions\n----------------------------\n\nFor the $d$-dimensional torus ${\\mathbb{T}}^{d}={\\mathbb{R}}^{d}/{\\mathbb{Z}}^{d}$, $d\\ge 2$, there are high spectral degeneracies; in this case Lester and Rudnick \u00a0[@LeRu Theorem 1.1] proved that the small-scale equidistribution is satisfied by a generic Laplace eigenfunction (also considered by Hezari and Rivi\u00e8re \u00a0[@Hezari-Riviere2]). More precisely, they showed that every o.n.b. $\\{\\phi_{j}\\}$ admits a density one subsequence $\\{\\phi_{j_{k}}\\}$ of Laplace eigenfunctions obeying , with $r_{0}(E)=E^{-\\alpha(d)}$, where $\\alpha(d)$ is any number smaller than $$\\label{eq:alpha(d) LeRu}\n\\alpha(d)<\\frac{1}{2(d-1)},$$ an (almost) optimal Planck-scale result for $d=2$, yet somewhat weaker than Berry\u2019s conjecture for $d> 2$.\n\nOne can express the real toral Laplace eigenfunctions explicitly as a sum of exponentials $$\\label{eq:fn sum exp}\nf_{n}\\left(x\\right)=\\sum_{\\lambda\\in\\mathcal{E}_{n}}c_{\\lambda}e\\left(\\left\\langle x,\\lambda\\right\\rangle \\right), \\hspace{10pt} (c_{-\\lambda}=\\overline{c_\\lambda})$$ for $$\\label{eq:S_d}\nn\\in S_{d}:=\\{n=a_{1}^{2}+\\ldots +a_{d}^{2}:\\: a_{1},\\ldots,a_{d}\\in{\\mathbb{Z}}\\}$$ expressible as a sum of $d$ integer squares, and the corresponding frequencies $\\lambda$ are the standard lattice points $$\\label{eq:E_n}\n{\\mathcal{E}}_{n} = {\\mathcal{E}}_{d;n}=\\{\\lambda\\in{\\mathbb{Z}}^{d}:\\: \\|\\lambda\\|^{2}=n\\}$$ lying on the $(d-1)$-dimensional sphere (a circle for $ d=2 $) of radius-$\\sqrt{n}$; in this case the energy is $E=E_{n}=4\\pi^{2}n$. We will assume w.l.o.g. that $f_{n}$ is $L^{2}$-normalised, equivalent to $$\\label{eq:BasicNormalization}\n\\|f_{n}\\|_{L^{2}({\\mathbb{T}}^{d})}^{2} = \\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|^{2}=1.$$\n\nFor every $ n\\in S_d $, denote $$\\label{eq:N}\n N=N_{d;n}=\\#\\mathcal{E}_n.$$\n\nWhen $d=2$, by Landau\u2019s theorem, $\n\\left\\{ n\\le x:\\,n\\in S_{2}\\right\\} \\sim K\\frac{x}{\\sqrt{\\log x}}\n$ where $ K>0 $ is the \u201cLandau-Ramanujan constant\". On average $N=N_{2;n}$ is of order of magnitude $\\sqrt{\\log n}$; however, for a density one sequence in $S_{2}$ we have $\nN=\\left(\\log n\\right)^{\\log2/2+o\\left(1\\right)}.\n$ In general, for $n\\in S_{2}$ we have $$N=n^{o\\left(1\\right)}.$$\n\nFor $d=3$, Siegel\u2019s theorem asserts that for $n\\not\\equiv0,4,7\\,\\left(8\\right)$, $$N=N_{3;n}=n^{1/2+o\\left(1\\right)};$$ since $x\\mapsto2^{a}x$ is a bijection between the solutions to $x_{1}^{2}+x_{2}^{2}+x_{3}^{2}=n$ and $x_{1}^{2}+x_{2}^{2}+x_{3}^{2}=4^{a}n$, we can always assume that $n\\not\\equiv0,4,7\\,\\left(8\\right)$ with no loss of generality.\n\nGranville and Wigman \u00a0[@GranvilleWigman Theorem 1.2] refined the aforementioned estimate by Lester-Rudnick for $d=2$. They proved that in this case, is valid slightly above Planck-scale $r_{0}(E)=E^{-1/2+o(1)}$, for [*all*]{} eigenfunctions $f_{n}$ as in , corresponding to numbers $n$ so that the lattice points ${\\mathcal{E}}_{n}$ are well-separated (\u201cBourgain-Rudnick sequences\"), a condition satisfied \u00a0[@Bourgain-Rudnick Lemma 5] by \u201cgeneric\" integers $n\\in S_{2}$ in a strong quantitative sense, subsequently refined in \u00a0[@GranvilleWigman Theorem 1.4], see section \\[sec:quasi corr\\].\n\nAveraging mass w.r.t. ball centre\n---------------------------------\n\nFor both the $2$-dimensional and the higher-dimensional tori it is possible to construct exceptional examples of sequences of toral eigenfunctions where the equidistribution condition is not satisfied: for $d\\ge 2$ thin sequences \u00a0[@LeRu Theorem $3.1$] $\\{\\phi_{j_{k}}\\}$ of eigenfunctions violating condition at Planck-scale $r \\cdot E_{j_{k}}^{1/2} \\rightarrow \\infty$, around the origin $x=0$, and even stronger, for $d\\ge 3$ \u00a0[@LeRu Theorem $4.1$ (construction by J. Bourgain)] eigenfunctions violating with $r \\gg E^{-\\alpha(d)}$ where $\\alpha(d)> \\frac{1}{2(d-1)}$, again around the origin $x=0$. In these cases, rather than keeping the ball centre $x=0$ at the origin, one may vary $x$, and study whether the \u201ctypical\" discrepancy on the l.h.s. of is [*small*]{}, even if the existence of $x$ so that the l.h.s. of is [*not small*]{} is known, so that, in particular, is not satisfied.\n\nA natural way to vary $x$ is to think of $x$ as [*random*]{}, drawn uniformly in ${\\mathbb{T}}^{d}$. We define the random variable $$\\label{eq:X_RV}\nX_{f_{n},r}=X_{f_{n},r;x}:= \\int\\limits_{B_{x}(r)}f_{n}(y)^{2}dy,$$ and are interested in the distribution of $X_{f_{n},r}$ where $x$ is drawn randomly uniformly in ${\\mathbb{T}}^{d}$. The relevant moments are: expectation $$\\label{eq:Expectation}\n{\\mathbb{E}}[X_{f_{n},r}] = \\int\\limits_{{\\mathbb{T}}^{d}}X_{f_{n},r;x}dx,$$ higher centred moments $$\\label{eq:centred moments}\n{\\mathbb{E}}[(X_{f_{n},r}-{\\mathbb{E}}[X_{f_{n},r}])^{k}] = \\int\\limits_{{\\mathbb{T}}^{d}}\\left(X_{f_{n},r;x}-{\\mathbb{E}}[X_{f_{n},r}]\\right)^{k}dx, \\hspace{1em}k\\ge2,$$ and in particular the variance $$\\label{eq:Variance}\n{\\mathcal{V}}(X_{f_{n},r}) = {\\mathbb{E}}[(X_{f_{n},r}-{\\mathbb{E}}[X_{f_{n},r}])^{2}].$$\n\nThis approach of averaging the $L^{2}$-mass with respect to the ball centre (and keeping $f_{n}$ fixed) was pursued by Granville-Wigman \u00a0[@GranvilleWigman] in the $2$-dimensional case, again slightly above the Planck scale $r>E^{-1/2+o(1)}$. In this regime, by proving an upper bound for ${\\mathcal{V}}(X_{f_{n},r})$ beyond $({\\mathbb{E}}[X_{f_{n},r}])^{2} = O(r^4)$, valid for [*all*]{} $n\\in S_{2}$, under some flatness assumption on $f_{n}$ (cf. Definition \\[def:ultraflat\\] below), they established for [*\u201ctypical\"*]{}, if [*not all*]{} $x\\in{\\mathbb{T}}^{2}$. It would be desirable to find a regime where it is possible to analyse the precise asymptotic behaviour of the variance ${\\mathcal{V}}(X_{f_{n},r})$ of $X_{f_{n},r}$, and, if possible, determine the limit distribution law for $X_{f_{n},r}$; our principal results below achieve both of these in the $2$-dimensional case, and the former in the $3$-dimensional one (see theorems \\[thm:VarMain\\] and \\[thm:Var3D\\]). Such an approach of bounding the discrepancy variance while averaging over ball centres was recently used by Sarnak \u00a0[@Sa] for mass distribution of forms on symmetric spaces, and P. Humphries \u00a0[@Humphries] for mass distribution of automorphic forms.\n\nStatement of the main results for $d=2,3$: asymptotics for the variance, CLT\n----------------------------------------------------------------------------\n\nOur principal results below are applicable to \u201cflat\" functions for $d=2,3$, understood in suitable, more and less restrictive, senses. For example, \u201cBourgain\u2019s eigenfunction\" [@Bourgain] $$\\label{eq:BourgainEF}\nf_{n}\\left(x\\right)=\\frac{1}{\\sqrt{N}}\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\varepsilon_{\\lambda}e\\left(\\left\\langle x,\\lambda\\right\\rangle \\right)$$ with $\\varepsilon_{\\lambda}=\\pm1$ for every $\\lambda\\in\\mathcal{E}_{n}$, i.e. corresponding to $\\left|c_{\\lambda}\\right|=N^{-1/2},$ satisfies any of the flatness conditions in the most restrictive sense. Denote ${\\mathcal{B}}_{n}$ to be the class of Bourgain\u2019s eigenfunctions.\n\nOur first principal result determines the precise asymptotic behaviour of the variance ${\\mathcal{V}}(X_{f_n,r})$ for the $2$-dimensional case, and moreover asserts that the moments of the standardized random $L^{2}$-mass of $f_{n}$ are asymptotically Gaussian; we subsequently deduce a Central Limit Theorem (see Corollary \\[cor:CLT\\_result\\]). For the sake of elegance of presentation, it is formulated for Bourgain\u2019s eigenfunctions ; below we formulate a more general result which holds for a larger class of flat eigenfunctions (see Theorem \\[thm:VarMainGeneralized\\] in section \\[sec:statement results strong\\]), and later a result where the averaging over the ball centre $x$ is itself restricted to shrinking balls (Theorem \\[thm:VarMainExplRestricted\\] in section \\[sec:RestrictedAverages\\]).\n\n\\[thm:VarMain\\] There exists a density one sequence $S_{2}'\\subseteq S_{2}$ so that the following holds. Let $r_{0}=r_{0}\\left(n\\right)=n^{-1/2}T_{0}\\left(n\\right)$ with $T_{0}\\left(n\\right)\\to\\infty $.\n\n1.  Fix a number $\\epsilon>0$, and suppose that $ T_0(n) < \\left(\\log n\\right)^{\\frac{1}{2}\\log\\frac{\\pi}{2}-\\epsilon} $. Then as $n\\to\\infty$ along $S_{2}'$ we have $$\\label{eq:var asympt d=2 Bourgain}\n    {\\mathcal{V}}\\left(X_{f_{n},r}\\right)\\sim\\frac{16}{3 \\pi}r^{4}T^{-1}$$ uniformly for all $$\\label{eq:r0<r<n^-1/2*discr}\n    r_{0} < r <n^{-1/2}\\left(\\log n\\right)^{\\frac{1}{2}\\log\\frac{\\pi}{2}-\\epsilon}$$ and $ f_n \\in {\\mathcal{B}}_{n} $, where $T:=n^{1/2}r.$\n\n2.  Under the above notation let $$\\label{eq:standardizedX}\n    \\hat{X}_{f_{n},r}:=\\frac{X_{f_{n},r}-{\\mathbb{E}}[X_{f_{n},r}]}{\\sqrt{{\\mathcal{V}}\\left(X_{f_{n},r}\\right)}}$$ be the standardized random $L^{2}$-mass of $f_{n}$, $r_{1}=r_{1}(n)=n^{-1/2}T_{1}\\left(n\\right)$, and suppose further that the sequence of numbers $T_{1}(n)>T_{0}(n)$ satisfies $T_{1}(n)=O\\left(N^{\\xi}\\right)$ for every $\\xi>0$. Then for all $k\\ge 3$ the $k$-th the moment of $\\hat{X}_{f_{n},r}$ converges, for $n\\rightarrow\\infty$ along $S_{2}'$, to the standard Gaussian moment $$\\label{eq:moments Gaussian lim}\n    {\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}] \\rightarrow {\\mathbb{E}}[Z^{k}],$$ uniformly for $r_{0}<r<r_{1}$ and $ f_n \\in {\\mathcal{B}}_{n} $, where $Z\\sim N(0,1)$ is the standard Gaussian variable.\n\nThe claimed uniform asymptotics of the variance means explicitly that, as $n\\rightarrow\\infty$ along $S_{2}'$, one has $$\\label{eq:var unif asymp d=2}\n\\sup\\limits_{\\substack{r_0 < r < \\left(\\log n\\right)^{\\frac{1}{2}\\log\\frac{\\pi}{2}-\\epsilon} \\\\ f_n \\in {\\mathcal{B}}_{n}}} \\left|\\frac{{\\mathcal{V}}\\left(X_{f_{n},r}\\right)}{\\frac{16}{3 \\pi}r^{4}T^{-1}}  -    1\\right| \\rightarrow 0$$ and the uniform convergence of the moments means that for every $k\\ge 3$, $$\\sup\\limits_{\\substack{r_0 < r < r_1 \\\\ f_n \\in {\\mathcal{B}}_{n}}} \\left|{\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}] - {\\mathbb{E}}[Z^{k}]\\right| \\rightarrow 0.$$ Concerning the restricted range in Theorem \\[thm:VarMain\\] (and ) for the possible radii, it is directly related to a well-known result on the angular distribution of lattice points in ${\\mathcal{E}}_{n}$, for generic $n\\in S_{2}$. Namely, it was shown \u00a0[@ErdosHall] that ${\\mathcal{E}}_{n}$, projected by homothety to the unit circle, is equidistributed, and moreover, a quantitative measure for the discrepancy is asserted (see section \\[sec:ang distr\\] below, and, in particular, ), satisfied by [*generic*]{} $n\\in S_{2}$. Bourgain \u00a0[@Bourgain] observed that $f_{n}\\in {\\mathcal{B}}_{n}$, when averaged over $x\\in {\\mathbb{T}}^{d}$, exhibits Gaussianity in the following sense. Let $T>0$ be a fixed number, and define the scaled function $\\varphi_{x}:[-1,1]^{2}\\rightarrow{\\mathbb{R}}$ around $x$ as $$\\label{eq:varphi rand x def}\n\\varphi_{x}(y):= f_{n}\\left( x+ \\frac{T}{\\sqrt{n}}\\cdot y\\right),$$ i.e. the trace of $f_{n}$ on the side-$2\\frac{T}{\\sqrt{n}}$ square centred at $x$. It was found \u00a0[@Bourgain], that, upon thinking of $x\\in{\\mathbb{T}}^{2}$ as [*random*]{}, and $\\varphi_{x}(\\cdot)$ as a [*random field*]{} indexed by $[-1,1]^{2}$, it converges, in a suitable sense, to a particular [*Gaussian*]{} field (\u201cmonochromatic isotropic waves\") on ${\\mathbb{R}}^{2}$, restricted to $[-1,1]^{2}$. This allows one to infer some results on the (deterministic) functions $f_{n}\\in {\\mathcal{B}}_{n}$ from the analogous results on the limit Gaussian random field. We may then reinterpret the quantitative version of the angular equidistribution of lattice points as allowing the parameter $T$ in to grow as a (positive) logarithmic power of $n$, while still retaining the said asymptotic Gaussianity, also allowing for the comparison between the mass distribution of $f_{n}$ w.r.t. the position and mass distribution of monochromatic isotropic waves. Our intuition regarding the possibility of carrying on the explained \u201cde-randomisation\" argument for establishing results of similar nature to the presented results was recently validated by Sartori \u00a0[@Sartori].\n\nAn application of the standard theory [@Feller \u00a7XVI.3 Lemma 2] allows us to infer a uniform Central Limit Theorem for the random variables $\\hat{X}_{f_{n},r}$ from the convergence of their respective moments to the Gaussian ones.\n\n\\[cor:CLT\\_result\\] In the setting of Theorem \\[thm:VarMain\\] part (2), the distribution of the random variables $\\{\\hat{X}_{f_{n},r}\\}$ converges uniformly to the standard Gaussian distribution: as $n\\rightarrow\\infty$ along $S_{2}'$ $${\\operatorname{meas}}\\{ x\\in \\mathbb{T}^2:\\: \\hat{X}_{f_{n},r;x} \\le t\\} \\rightarrow\n\\frac{1}{\\sqrt{2\\pi}}\\int\\limits_{-\\infty}^{t}e^{-z^{2}/2}dz,$$ uniformly for $t\\in{\\mathbb{R}}$, $r_{0}<r<r_{1}$ and $ f_n \\in {\\mathcal{B}}_{n} $.\n\nFor the $3$-dimensional case, for Bourgain\u2019s eigenfunctions, we only claim precise asymptotic result on $\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)$, the good news being that the claimed results are valid for [*all*]{} energies satisfying the natural congruence assumptions.\n\n\\[thm:Var3D\\] There exists a number $\\eta>0$ such that if $r_{0}=r_{0}(n)=n^{-1/2}T_{0}(n)$ with $T_{0}(n)\\rightarrow\\infty$, then for all $n\\not\\equiv0,4,7\\,\\left(8\\right)$ we have $$\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)\\sim r^{6}T^{-2},$$ uniformly for $r_{0} <  r < n^{-1/2+\\eta}$ and $ f_n \\in {\\mathcal{B}}_{n} $.\n\nThe meaning of the uniform statement in Theorem \\[thm:Var3D\\] is that $$\\sup_{\\begin{subarray}{c}\nr_{0} < r < n^{-1/2+\\eta} \\\\ f_n \\in {\\mathcal{B}}_{n} \\end{subarray}}\\left|\\frac{\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)}{r^{6}T^{-2}}-1\\right|\\to0\\label{eq:AympVar3D}$$ as $n\\to\\infty$ along $n\\not\\equiv0,4,7\\,\\left(8\\right)$, cf. in the $2$-dimensional case.\n\nStatement of the main results for $d=2,3$: more general upper and lower bounds {#sec:statement results weak}\n------------------------------------------------------------------------------\n\nLet $f_{n}$ be as in , and consider the vector $$\\label{eq:v_def}\n\\underline{v}:=(|c_{\\lambda}|^{2})_{\\lambda \\in{\\mathcal{E}}_{n}} \\in {\\mathbb{R}}^{\\mathcal{E}_n} $$ of the squared absolute values of its coefficients; we denote its normalised $\\ell_{\\infty}$-norm $$\\label{eq:vnorm inf}\n[\\underline{v}]_{\\infty} := N \\cdot \\max\\limits_{\\lambda\\in{\\mathcal{E}}_{n}}|c_{\\lambda}|^{2}.$$\n\n\\[def:ultraflat\\]\n\nWe say that an eigenfunction $f_{n}$ in is $\\epsilon$-ultraflat if its coefficients satisfy $$\\label{eq:ultra_flat_cond}\n[\\underline{v}]_{\\infty} \\le N^{\\epsilon}.$$ Denote ${\\mathcal{U}}_{n;\\epsilon}$ to be the class of $\\epsilon$-ultraflat functions.\n\nThe following couple of theorems establish more general upper and lower bounds on ${\\mathcal{V}}(X_{f_n,r})$ in the $2$ and $3$-dimensional cases respectively.\n\n\\[thm:UpperBound2d\\] There exists a density $1$ sequence $S_{2}'\\subseteq S_{2}$ and an absolute constant $C>0$ such that for every $ \\epsilon>0 $, $ \\eta >0 $, $r_{0}=r_{0}(n)=n^{-1/2}T_{0}(n)$ with $T_{0}(n)\\rightarrow\\infty$ arbitrarily slowly, and $r=n^{-1/2}T>r_{0}$, as $n\\to\\infty$ along $S_{2}'$ we have $$\\label{eq:bounds var ultraflat d=2}\nT^{-1}N^{-2\\epsilon}\\ll    \\frac{{\\mathcal{V}}(X_{f_n,r})}{r^{4}} \\ll N^{\\epsilon}\\cdot \\left(T^{-1}+(\\log{n})^{-\\frac{1}{2}\\log{\\frac{\\pi}{2}}+\\eta}   \\right)$$ uniformly for $r_{0} < r< Cn^{-1/2}N^{1-\\epsilon}$ and $f_{n}\\in {\\mathcal{U}}_{n;\\epsilon}$, with the constant involved in the \u201c$\\ll$\"-notation in is absolute for the lower bound, and depends only on $\\eta$ for the upper bound. Moreover, the upper bound is valid for the extended range $r > r_{0}$ (with no upper bound on $r$ imposed), and the lower bound is valid for every $ n\\in S_2 $.\n\n\\[thm:UpperBound3d\\] There exists a number $\\eta>0$ and a constant $C>0$ such that for every $\\epsilon>0$, $r_{0}=r_{0}(n)=n^{-1/2}T_{0}(n)$ with $T_{0}(n)\\rightarrow\\infty$ arbitrarily slowly, $r=n^{-1/2}T>r_{0}$, and $n\\not\\equiv 0,4,7\\,\\left(8\\right)$ we have $$\\label{eq:bounds var ultraflat d=3}\nT^{-2}N^{-2\\epsilon}  \\ll \\frac{{\\mathcal{V}}(X_{f_{n},r})}{r^{6}} \\ll N^{\\epsilon} \\left( T^{-2}+n^{-\\eta}\\right),$$ uniformly for $r_{0} < r < Cn^{-1/2}N^{1-\\epsilon}$ and $f_{n}\\in {\\mathcal{U}}_{n;\\epsilon}$, where the constants involved in the \u201c$\\ll$\"-notation are absolute. Moreover, the upper bound in is valid for the extended range $r > r_{0}$.\n\nFor Bourgain\u2019s eigenfunctions, the proofs of Theorem \\[thm:UpperBound2d\\] and Theorem \\[thm:UpperBound3d\\] yield slightly stronger bounds compared to and , namely $$T^{-1}\\ll    \\frac{{\\mathcal{V}}(X_{f_n,r})}{r^{4}} \\ll  T^{-1}+(\\log{n})^{-\\frac{1}{2}\\log{\\frac{\\pi}{2}}+\\epsilon}$$ for $ d=2 $, and $$T^{-2}  \\ll \\frac{{\\mathcal{V}}(X_{f_{n},r})}{r^{6}} \\ll   T^{-2}+n^{-\\eta}$$ for $ d=3 $.\n\nOutline of the paper\n--------------------\n\nThe rest of the paper is organised as follows. In section \\[sec:statement results strong\\] we formulate Theorem \\[thm:VarMainGeneralized\\], which, on one hand generalizes Theorem \\[thm:VarMain\\] for a larger class of flat eigenfunctions, and on the other hand, explicates a sufficient condition on $ n\\in S_2 $ for its statements to hold; a few examples of application of Theorem \\[thm:VarMainGeneralized\\], corresponding to different asymptotic behaviour of the variance , are also discussed. Section \\[sec:Proof\\_Main\\_thm\\_part1\\] is dedicated to giving a proof of the first part of Theorem \\[thm:VarMain\\] (resp. $1$st part of Theorem \\[thm:VarMainGeneralized\\]), whereas the second part of Theorem \\[thm:VarMain\\] (resp. $2$nd part of Theorem \\[thm:VarMainGeneralized\\]) is proved in section \\[sec:Proof\\_Main\\_thm\\_part2\\]. Theorem \\[thm:Var3D\\], claiming the precise asymptotics for the $L^{2}$-mass variance for Bourgain\u2019s eigenfunctions in $3$d, is proved in section \\[sec:Proof\\_3d\\_theorem\\].\n\nIn section \\[sec:ProofOfBoundsThm\\] we prove the various upper and lower bounds asserted by theorems \\[thm:UpperBound2d\\] and \\[thm:UpperBound3d\\]. A refinement of Theorem \\[thm:VarMainGeneralized\\], where rather than draw $x$ w.r.t. the uniform measure on the full torus, $x$ is drawn on balls slightly above Planck scale, is presented in section \\[sec:RestrictedAverages\\], and the additional subtleties of its proof as compared to the proof of Theorem \\[thm:VarMainGeneralized\\] are highlighted. Finally, section \\[sec:AuxLemmasProof\\] contains the proofs of all auxiliary lemmas, postponed in course of the proofs of the various results.\n\nAcknowledgements {#acknowledgements .unnumbered}\n----------------\n\nThe authors of this manuscript wish to express their gratitude to J. Benatar, A. Granville, P. Kurlberg, Z. Rudnick, P. Sarnak and M. Sodin for numerous stimulating and fruitful discussions concerning various aspects of our work, and their interest in our research. It is a pleasure to thank the anonymous referee for his comments on an earlier version of this manuscript. The research leading to these results has received funding from the European Research Council under the European Union\u2019s Seventh Framework Programme (FP7/2007-2013), ERC grant agreement n$^{\\text{o}}$ 335141.\n\nOn Theorem \\[thm:VarMain\\]: CLT for mass distribution, $d=2$ {#sec:statement results strong}\n============================================================\n\nIn this section we focus on Theorem \\[thm:VarMain\\]. Our first goal is to formulate a result, that on one hand generalises the statement of Theorem \\[thm:VarMain\\] to a larger class of eigenfunctions, and, on the other hand, provides a more explicit control over the generic numbers $n\\in S_{2}$. To this end we discuss the angular distribution of $\\lambda\\in{\\mathcal{E}}_{n}$ (section \\[sec:ang distr\\]), and the spectral correlations (section \\[sec:quasi corr\\]), also used in the course of the proof of the $3$-dimensional Theorem \\[thm:Var3D\\]; we will be able to formulate Theorem \\[thm:VarMainGeneralized\\], as prescribed above, by appealing to these. In section \\[eq:examples varying theta\\] we consider a few scenarios when Theorem \\[thm:VarMainGeneralized\\] is applicable, prescribing different asymptotic behaviour for the variance .\n\nAngular equidistribution of lattice points {#sec:ang distr}\n------------------------------------------\n\nFor every $\\lambda=\\left(\\lambda_{1},\\lambda_{2}\\right)\\in\\mathcal{E}_{n}$, write $\\lambda_{1}+i\\lambda_{2}=\\sqrt{n}e^{i\\phi}$, and denote the various angles by $$0\\le\\phi_{1}<\\phi_{2}<\\dots<\\phi_{N}<2\\pi.$$ Recall that the discrepancy of the sequence $\\phi_{j}$ is defined by $$\\label{eq:Discrepancy_2d}\n\\Delta\\left(n\\right)=\\sup_{0\\le a\\le b\\le2\\pi}\\left|\\frac{1}{N}\\cdot \\#\\left\\{ 1\\le j\\le N:\\,\\phi_{j}\\in\\left[a,b\\right]\\,\\text{mod\\,}2\\pi\\right\\} -\\frac{\\left(b-a\\right)}{2\\pi}\\right|.$$\n\nFor every $ \\epsilon>0 $, we say that $ n\\in S_2 $ satisfies the hypothesis $ \\mathcal{D}(n,\\epsilon) $ if $$\\label{eq:D_n_epsilon}\n\\Delta\\left(n\\right)\\le \\left(\\log n\\right)^{-\\frac{1}{2}\\log\\frac{\\pi}{2}+\\epsilon}.$$ By Erd\u0151s-Hall [@ErdosHall Theorem 1], there exists a density one sequence $S_2'(\\epsilon)\\subseteq S_2 $ such that $ \\mathcal{D}(n,\\epsilon) $ is satisfied for every $n\\in S_2'(\\epsilon) $. By a standard diagonalization argument, there exists a density one sequence $ S_2'\\subseteq S_2 $ such that $\\mathcal{D}(n,\\epsilon) $ is satisfied for *every* $ \\epsilon>0 $ and $n\\in S_2' $ sufficiently large. In particular, the angles $\\left\\{ \\phi_{j}\\right\\} $ are equidistributed mod $2\\pi$ along this sequence, i.e., the lattice points are equidistributed on the corresponding circles.\n\nSpectral correlations in $2d$ (and $3d$) {#sec:quasi corr}\n----------------------------------------\n\nFor $d=2$, while computing the moments of $X_{f_{n},r}$ (e.g. for Bourgain\u2019s eigenfunction ), with $x$ drawn uniformly on the whole of ${\\mathbb{T}}^{2}$, one exploits the orthogonality relations $$\\int\\limits_{{\\mathbb{T}}^{2}}e(\\langle  \\lambda , x  \\rangle)dx = \\begin{cases}\n0 &\\lambda\\ne 0 \\\\ 1 &\\lambda=0\n\\end{cases}$$ for $\\lambda\\in{\\mathbb{Z}}^{2}$ to naturally encounter the length-$l$ spectral correlation problem. That is, for $l\\ge 2$ and $n\\in S_{2} $ one is interested in the size of the length-$ l $ spectral correlation set $$\\label{eq:Sc correlations def}\n{\\mathcal{S}}_{n}(l) = \\left\\{ (\\lambda^{1},\\ldots,\\lambda^{l})\\in({\\mathcal{E}}_{n})^{l}:\\: \\sum\\limits_{i=1}^{l}\\lambda^{i}=0  \\right\\},$$ which, by an elementary congruence obstruction argument modulo $ 2 $, is only non-empty for $l=2k$ even.\n\nIn this case $l=2k$ we further define the [*diagonal*]{} correlations set to be all the permutations of tuples of the form $(\\lambda^{1},-\\lambda^{1},\\ldots, \\lambda^{k},-\\lambda^{k})$: $$\\label{eq:Dc diag def}\n{\\mathcal{D}}_{n}(l) = \\left\\{ \\pi(\\lambda^{1},-\\lambda^{1},\\ldots,\\lambda^{k},-\\lambda^{k}): \\lambda^{1},\\ldots,\\lambda^{k}\\in ({\\mathcal{E}}_{n})^{k},\\,\\pi\\in S_{l}\\right\\}.$$ The set ${\\mathcal{D}}_{n}$ is dominated by non-degenerate tuples (i.e. $\\lambda^{i}\\ne \\pm\\lambda^{j}$ for $ i\\ne j $), hence its size is asymptotic to $$|{\\mathcal{D}}_{n}(l)|=  \\frac{(2k)!}{2^{k}\\cdot k!}N^{k}\\cdot \\left(1 + O_{N\\rightarrow\\infty}\\left( \\frac{1}{N} \\right)  \\right).$$\n\nClearly, ${\\mathcal{D}}_{n}(l)\\subseteq {\\mathcal{S}}_{n}(l)$ so that, in particular ${\\mathcal{S}}_{n}(l) \\gg N^{l/2}$. To the other end, we have ${\\mathcal{S}}_{n}(2) = {\\mathcal{D}}_{n}(2)$ by the definition, and both the precise statement $$\\label{eq:Zygmund 4-corr}\n{\\mathcal{S}}_{n}(4) = {\\mathcal{D}}_{n}(4)$$ (used for the variance computation below) and the bound $$|{\\mathcal{S}}_{n}(l)| = O_{N\\rightarrow\\infty}(N^{l-2})$$ follow from Zygmund\u2019s elementary observation \u00a0[@Zygmund]. For $ l=6 $, Bourgain (published in \u00a0[@K-K-W]) improved Zygmund\u2019s bound to $$|{\\mathcal{S}}_{n}(6)| = o_{N\\rightarrow\\infty}(N^{4});$$ this was improved \u00a0[@BombieriBourgain] to $$|{\\mathcal{S}}_{n}(6)| = O_{N\\rightarrow\\infty}(N^{7/2}),$$ valid for [*all*]{} $n\\in S_{2}$.\n\nIf one is willing to excise a thin sequence in $S_{2}$, then the more striking estimate [@BombieriBourgain] $$|{\\mathcal{S}}_{n}(6)| = |{\\mathcal{D}}_{n}(6)| + O(N^{3-\\gamma}),$$ with some $\\gamma >0$, is valid for a density $1$ sequence $S_{2}'\\subseteq S_{2}$. More generally [@Bourgain], for every $l\\ge 6$ even, there exists a density $1$ sequence $S_{2}'(l)\\subseteq S_{2}$ and a number $\\gamma_{l}>0$ such that $$\\label{eq:corr diag dom l}\n|{\\mathcal{S}}_{n}(l)| = |{\\mathcal{D}}_{n}(l)| + O(N^{l/2-\\gamma_l})$$ along $n\\in S_{2}'(l)$. A standard diagonal argument then yields the existence of a density $1$ sequence $S_2'\\subseteq S_{2}$ so that is valid for [*all*]{} even $l\\ge 4$.\n\nGiven an even number $l=2k\\ge 2$ we say that a sequence $S_{2}'\\subseteq S_{2}$ satisfies the length-$l$ [**diagonal domination**]{} assumption if there exists a number $\\gamma=\\gamma_l >0$ so that holds.\n\nFor the $3$-dimensional case under the consideration of Theorem \\[thm:Var3D\\] the analogous estimates to are required to evaluate the relevant moments of $X_{f_{n},r}$. We define ${\\mathcal{S}}_{3;n}$ and ${\\mathcal{D}}_{3;n}$ analogously to and respectively, this time the $\\lambda^{i}$ are lying on the $2$-sphere of radius $\\sqrt{n}$. Unlike the lattice points lying on circles, Zygmund\u2019s argument is not applicable for the $2$-sphere, so that an analogue of is not valid; luckily the asymptotic statement $$\\label{eq:3d 4-corr}\n|{\\mathcal{S}}_{3;n}(4)| = |{\\mathcal{D}}_{3;n}(4)| + O\\left( N^{7/4 +\\epsilon}  \\right),$$ a key input to the variance computation in Theorem \\[thm:Var3D\\], was recently established \u00a0[@BenatarMaffucci]. It was also shown in [@BenatarMaffucci] that the asymptotic diagonal domination for the higher length correlations sets does not hold in the $ 3 $-dimensional case.\n\nA more general version of Theorem \\[thm:VarMain\\], with explicit control over $S_{2}'$ {#sec:VarMainExpl}\n--------------------------------------------------------------------------------------\n\nWe are interested in extending Theorem \\[thm:VarMain\\] to a larger class of eigenfunctions. To this end, we introduce the following notation:\n\nLet $f_{n}$ be an eigenfunction on the $2$-torus corresponding to coefficients $(c_{\\lambda})_{\\lambda\\in{\\mathcal{E}}_{n}}$ via , and $\\underline{v}\\in{\\mathbb{R}}^{\\mathcal{E}_n}\\simeq {\\mathbb{R}}^{N}$ as above.\n\n1.  Denote $$\\label{eq:A4Def}\n            A_{4} = A_{4}(\\underline{v}) = N\\sum\\limits_{\\lambda\\in{\\mathcal{E}}_{n}} |c_{\\lambda}|^{4} = N\\cdot \\|\\underline{v}\\|^{2}.$$\n\n2.  Given $\\lambda\\in{\\mathcal{E}}_{n}$ let $\\lambda_{+}$ be the clockwise nearest neighbour of $\\lambda$ on $\\sqrt{n}\\mathcal{S}^{1}$, and $$\\label{eq:BasicVariablesV}\n            V\\left(\\underline{v} \\right):=\n            N\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|\\left|c_{\\lambda_{+}}\\right|^{2}-\\left|c_{\\lambda}\\right|^{2}\\right|.$$\n\n3.  Let $$\\label{eq:alphaDef}\n            \\widetilde{V}(\\underline{v}) = \\frac{[\\underline{v}]_{\\infty} \\cdot V(\\underline{v})}{A_{4}(\\underline{v})}.$$\n\nThe following Lemma, proved in section \\[sec:AuxLemmasProof\\], summarizes some basic properties of the quantities in (\\[eq:vnorm inf\\]), (\\[eq:A4Def\\]), (\\[eq:BasicVariablesV\\]) and (\\[eq:alphaDef\\]):\n\n\\[lem:BasicVarProp\\] We have\n\n1.  $1\\le A_{4} \\le[\\underline{v}]_{\\infty}.$\n\n2.  $[\\underline{v}]_{\\infty} \\le1+V\\left(\\underline{v} \\right)$.\n\n3.  $V\\left(\\underline{v} \\right) \\le\\widetilde{V}(\\underline{v})\\le V\\left(\\underline{v} \\right)\\left(1+V\\left(\\underline{v} \\right)\\right)$.\n\nBy we have that $$\\label{eq:A4<->theta}\nA_{4} = \\cos(\\theta)^{-2},$$ where $\\theta = \\theta_{f_n} = \\theta(\\underline{v},\\underline{v_{0}})$ is the angle between $\\underline{v}$ and the vector $\\underline{v_{0}}= (\\frac{1}{N})_{\\lambda\\in{\\mathcal{E}}_{n}}$ corresponding to Bourgain\u2019s eigenfunctions, hence $ \\theta $ reflects the proximity of $f_{n}$ to Bourgain\u2019s eigenfunction; by the first part of Lemma \\[lem:BasicVarProp\\], the angle $\\theta$ is restricted to the interval $ \\left[0,\\arccos \\left(1/\\sqrt{N}\\right)\\right] \\subseteq [0,\\pi/2) $.\n\nGiven a sequence $T(n)\\rightarrow\\infty$ and a sequence $\\eta(n)>0$ we define:\n\n1.  A sequence $\\{{\\mathcal{F}}_{1}(n;T(n),\\eta(n))\\}_{n}$ of families of functions consisting for $n\\in S_2$ of all functions $f_{n}$ as in satisfying $$\\label{eq:F_1_def}{\\mathcal{F}}_{1}(n;T(n),\\eta(n)) = \\left\\{f_{n}:\\: \\widetilde{V}(\\underline{v})< \\eta(n) \\cdot \\frac{T(n)}{\\log T(n)} \\right\\}.$$\n\n2.  A sequence $\\{{\\mathcal{F}}_{2}(n;T(n),\\eta(n))\\}_{n}$ of families of functions consisting for $n\\in S_2$ of all functions $f_{n}$ as in satisfying $$\\label{eq:F_2_def}{\\mathcal{F}}_{2}(n;T(n),\\eta(n)) = \\left\\{f_{n}:\\: [\\underline{v}]_{\\infty} < T(n)^{\\eta(n)} \\right\\},$$ where we recall the notation for $[\\underline{v}]_{\\infty}$.\n\nWe are now in a position to state the generalized version of Theorem \\[thm:VarMain\\]:\n\n\\[thm:VarMainGeneralized\\] Let $r_{0}=r_{0}\\left(n\\right)=n^{-1/2}T_{0}\\left(n\\right)$ with $T_{0}\\left(n\\right)\\to\\infty$, and $\\eta(n)>0$ any vanishing sequence $\\eta(n)\\rightarrow 0$.\n\n1.  Fix a number $\\epsilon>0$, and suppose that $ T_0(n) < \\left(\\log n\\right)^{\\frac{1}{2}\\log\\frac{\\pi}{2}-\\epsilon} $. Then, if $S_{2}'\\subseteq S_{2}$ is a sequence satisfying $ \\mathcal{D}(n,\\epsilon/2)$ for all $n\\in S_{2}'$, as $n\\rightarrow\\infty$ along $S_{2}'$, we have $$\\label{eq:var asympt d=2 precise}\n    {\\mathcal{V}}\\left(X_{f_{n},r}\\right)\\sim\\frac{16}{3 \\pi \\cos^{2}\\theta_{f_{n}}}r^{4}T^{-1}$$ with $\\theta_{f_{n}}$ as in , uniformly for all $r_{0} < r <n^{-1/2}\\left(\\log n\\right)^{\\frac{1}{2}\\log\\frac{\\pi}{2}-\\epsilon}$ and $f_{n}\\in{\\mathcal{F}}_{1}(n;T(n),\\eta(n))$, where $T:=T(n)=n^{1/2}r.$\n\n2.  Let $k\\ge 3$ be an integer, $r_{1}=r_{1}(n)=n^{-1/2}T_{1}\\left(n\\right)$, and suppose further that the sequence of numbers $T_{1}(n)>T_{0}(n)$ satisfies $T_{1}(n)=O\\left(N^{\\xi}\\right)$ for every $\\xi>0$. Suppose that $S_{2}'\\subseteq S_{2}$ is a sequence satisfying the length-$2k$ diagonal domination assumption and the hypothesis $\\mathcal{D}(n,\\epsilon)$ for all $n\\in S_{2}'$. Then the $k$-th the moment of $\\hat{X}_{f_{n},r}$ converges, as $n\\rightarrow\\infty$ along $S_{2}'$, to the standard Gaussian moment $${\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}] \\rightarrow {\\mathbb{E}}[Z^{k}],$$ uniformly for $r_{0}<r<r_{1}$ and $f_{n}\\in {\\mathcal{F}}_{2}(n;T(n),\\eta(n))$ where $Z\\sim N(0,1)$ is the standard Gaussian variable.\n\nSection \\[eq:examples varying theta\\] exhibits a few scenarios when Theorem \\[thm:VarMainGeneralized\\] is applicable; as in these the true asymptotic behaviour of the variance genuinely varies together with $\\theta_{f_{n}}$, this demonstrates that $\\theta_{f_{n}}$ (and hence $A_{4}$) is the proper flatness measure of $f_{n}$, see also examples \\[ex:Bourgain\\] and \\[ex:flat vs nonflat\\].\n\nIn the setting of Theorem \\[thm:VarMainGeneralized\\] part (2), the distribution of the random variables $\\{\\hat{X}_{f_{n},r}\\}$ converges uniformly to the standard Gaussian distribution: as $n\\rightarrow\\infty$ along $S_{2}'$ $${\\operatorname{meas}}\\{ x\\in\\mathbb{T}^2 :\\: \\hat{X}_{f_{n},r;x} \\le t\\} \\rightarrow\n    \\frac{1}{\\sqrt{2\\pi}}\\int\\limits_{-\\infty}^{t}e^{-z^{2}/2}dz,$$ uniformly for $t\\in{\\mathbb{R}}$, $r_{0}<r<r_{1}$, and $f_{n}\\in {\\mathcal{F}}_{2}(n;T(n),\\eta(n))$.\n\nSome examples of application of Theorem \\[thm:VarMainGeneralized\\] {#eq:examples varying theta}\n------------------------------------------------------------------\n\n\\[ex:Bourgain\\] Let $ f_n $ be Bourgain\u2019s eigenfunction, so that $ [\\underline{v}]_{\\infty} =A_4 =1 $ and $ V\\left(\\underline{v} \\right) = \\widetilde{V}(\\underline{v}) =0 $. For every $ \\eta(n)>0,T(n)>1 $ we have $${\\mathcal{B}}_{n} \\subseteq {\\mathcal{F}}_{1}(n;T(n),\\eta(n)) \\cap {\\mathcal{F}}_{2}(n;T(n),\\eta(n)).$$ Hence Theorem \\[thm:VarMainGeneralized\\] implies Theorem \\[thm:VarMain\\].\n\nThe following example exhibits a scenario when an application of Theorem \\[thm:VarMainGeneralized\\] yields a Central Limit Theorem for $X_{f_{n},r}$, corresponding to asymptotic behaviour of the respective variance ${\\mathcal{V}}(X_{f_{n},r})$ which is very different from the behaviour in Theorem \\[thm:VarMain\\].\n\n\\[ex:flat vs nonflat\\]\n\nLet $\\epsilon>0$, $r_{0}$, and $ T_0(n) $ as in Theorem \\[thm:VarMainGeneralized\\], and $r_{1}= r_1(n)=n^{-1/2} T_{1}(n) > r_{0}$ with $T_{1}(n) \\le (\\log{n})^{\\frac{1}{2}\\log{\\frac{\\pi}{2}}-\\epsilon}$. There exists a density $1$ sequence $S_{2}'\\subseteq S_{2}$ so that the following holds. Let $t=t(n)\\in (0,1)$ be a number satisfying $t(n) \\gg \\frac{1}{T_{0}(n)^{\\xi}}$ for every $\\xi>0$, such that $N\\cdot t$ is an integer. We choose an ordering $\\lambda^{1},\\lambda^{2},\\ldots \\lambda^{N}\\in{\\mathcal{E}}_{n}$ such that for every $1\\le i \\le N-1$ we have that $\\lambda^{i+1}$ is the (clockwise) nearest neighbour $\\lambda^{i+1}=\\lambda^{i}_{+}$, and set $$\\left(\\left|c_{\\lambda^{1}}\\right|^{2},,\\dots,\\left|c_{\\lambda^{N}}\\right|^{2}\\right)=(\\underset{\\begin{subarray}{c}\nNt\\end{subarray}\\text{\\,times}}{\\underbrace{\\left(Nt\\right)^{-1},\\dots\\dots,\\left(Nt\\right)^{-1}}},0\\dots,0).$$ Then $$\\label{eq:var asympt nonflat}\n{\\mathcal{V}}(X_{f_{n},r}) \\sim \\frac{16}{3 \\pi}r^{4}t^{-1}T^{-1},$$ uniformly for $r_{0}<r=n^{-1/2}T<r_{1}$, and $f_{n}$ with coefficients $c_{\\lambda}$ as above. If, in addition, we have $T_{1}(n)=O(N^{\\xi})$ for every $\\xi>0$, then the distribution of the standardised random variable $\\hat{X}_{f_{n},r}$ converges to standard Gaussian uniformly.\n\nComparing to we observe that the asymptotic behaviour of the variance for the flat and the non-flat functions respectively is genuinely different, provided that we choose $t(n)\\rightarrow 0$; we infer that the proposed flatness measure is the natural choice for this problem. One can also generalise Theorem \\[thm:VarMain\\] as follows:\n\n\\[cor:VarAsympGen\\]\n\nLet $\\epsilon$, $r_{0}$, $T_{0}(n)$, $r_{1}$ and $T_{1}(n)$ be as in Theorem \\[thm:VarMainGeneralized\\], and $g:{\\mathcal{S}}^{1}\\rightarrow{\\mathbb{R}}$ a non-negative function of bounded variation such that $ \\|g\\|_{L^{1}({\\mathcal{S}}^{1})}=1$. For $n\\in S_{2}$ and $\\lambda\\in {\\mathcal{E}}_{n}$ we set $|\\widetilde{c_{\\lambda}}|^{2} := g(\\lambda/\\sqrt{n})$, and normalise the vector $\\widetilde{\\underline{v}}:=(|\\widetilde{c_{\\lambda}}|^{2})_{\\lambda\\in{\\mathcal{E}}_{n}}$ by setting $\\underline{v} := \\frac{\\widetilde{\\underline{v}}}{\\|\\widetilde{\\underline{v}}\\|_{1}}$, i.e. $$\\label{eq:v BV norm}\nv:=(|{c_{\\lambda}}|^{2})_{\\lambda\\in{\\mathcal{E}}_{n}} =\n\\left(\\frac{|\\widetilde{c_{\\lambda}}|^{2}}{\\sum\\limits_{\\mu\\in{\\mathcal{E}}_{n}}|\\widetilde{c_{\\mu}}|^{2}}\\right)_{\\lambda\\in{\\mathcal{E}}_{n}}.$$\n\nThen along a generic sequence $S_{2}'\\subseteq S_{2}$ we have $${\\mathcal{V}}(X_{f_{n},r}) \\sim \\frac{16}{3 \\pi}\\|g\\|_{L^{2}({\\mathcal{S}}^{1})}^{2}r^{4}T^{-1},$$ uniformly for $r_{0}<r=n^{-1/2}T<r_{1}$, and $f_{n}$ with coefficients $c_{\\lambda}$ as in . If, in addition, we have $T_{1}(n)=O(N^{\\xi})$ for every $\\xi>0$, then the distribution of the standardised random variable $\\hat{X}_{f_{n},r}$ converges to standard Gaussian.\n\nBy Koksma\u2019s inequality (see e.g. [@KuipersNiederreiter]), $A_{4}\\left(\\underline{v} \\right)\\sim\\left\\Vert g\\right\\Vert _{2}^{2}$ along a density one sequence in $S_{2}$. Also note that $$V(\\underline{v}) \\ll V\\left(g\\right),$$ with the l.h.s. as in , and r.h.s. the variation of $g$ on ${\\mathcal{S}}^{1}$. In light of Lemma \\[lem:BasicVarProp\\], both parts of Corollary \\[cor:VarAsympGen\\] follow from Theorem \\[thm:VarMainGeneralized\\].\n\nNotation\n========\n\nFor the convenience of the reader, we summarize here the notation used in our paper.\n\n$ S_d=\\{n=a_{1}^{2}+\\ldots +a_{d}^{2}:\\: a_{1},\\ldots,a_{d}\\in{\\mathbb{Z}}\\} $: the set of integers expressible as a sum of $ d $ squares, see .\\\n${\\mathcal{E}}_{n} = {\\mathcal{E}}_{d;n}=\\{\\lambda\\in{\\mathbb{Z}}^{d}:\\: \\|\\lambda\\|^{2}=n\\}$: the standard lattice points lying on the $(d-1)$-dimensional sphere (a circle for $ d=2 $) of radius-$\\sqrt{n}$, see .\\\n$f_{n}\\left(x\\right)=\\sum\\limits_{\\lambda\\in\\mathcal{E}_{n}}c_{\\lambda}e\\left(\\left\\langle x,\\lambda\\right\\rangle \\right)$: the toral Laplace eigenfunctions, see .\\\n$ N=N_{d;n}=\\#\\mathcal{E}_n$: the number of lattice points on the $(d-1)$-dimensional sphere (a circle for $ d=2 $) of radius-$\\sqrt{n}$, see .\\\n$B_{x}(r)$: the radius $r$ geodesic ball in $\\mathbb{T}^d$ centred at $x$.\\\n$X_{f_{n},r}=X_{f_{n},r;x}= \\int\\limits_{B_{x}(r)}f_{n}(y)^{2}dy$: the $L^{2}$-mass of $ f_n $ restricted to $ B_{x}(r) $, where $ x $ is drawn randomly uniformly in $ \\mathbb{T}^d $, see .\\\n${\\mathbb{E}}[X_{f_{n},r}] = \\int\\limits_{{\\mathbb{T}}^{d}}X_{f_{n},r;x}dx$: the expected value of $X_{f_{n},r} $, see .\\\n${\\mathcal{V}}(X_{f_{n},r}) = {\\mathbb{E}}[(X_{f_{n},r}-{\\mathbb{E}}[X_{f_{n},r}])^{2}]$: the variance of $X_{f_{n},r} $, see .\\\n$\\hat{X}_{f_{n},r}:=\\frac{X_{f_{n},r}-{\\mathbb{E}}[X_{f_{n},r}]}{\\sqrt{{\\mathcal{V}}\\left(X_{f_{n},r}\\right)}}$: the standardized random $L^{2}$-mass of $ f_n $, see .\\\n$ T = n^{1/2}r $.\\\n$\\underline{v}=(|c_{\\lambda}|^{2})_{\\lambda \\in{\\mathcal{E}}_{n}} \\in {\\mathbb{R}}^{\\mathcal{E}_n} $: the vector of the squared absolute values of the coefficients of $f_n $, see .\\\n$[\\underline{v}]_{\\infty} = N \\cdot \\max\\limits_{\\lambda\\in{\\mathcal{E}}_{n}}|c_{\\lambda}|^{2}$: the normalised $\\ell_{\\infty}$-norm of $ \\underline{v} $, see .\\\n$\\mathcal{B}_n$: the class of Bourgain\u2019s eigenfunctions $f_{n}\\left(x\\right)=\\frac{1}{\\sqrt{N}}\\sum\\limits_{\\lambda\\in\\mathcal{E}_{n}}\\varepsilon_{\\lambda}e\\left(\\left\\langle x,\\lambda\\right\\rangle \\right)$, where $\\varepsilon_{\\lambda}=\\pm1$ for every $\\lambda\\in\\mathcal{E}_{n}$, see .\\\n${\\mathcal{U}}_{n;\\epsilon}$: the class of $ \\epsilon $-ultraflat functions, where $ [\\underline{v}]_{\\infty} \\le N^{\\epsilon} $, see .\\\n$A_{4} = A_{4}(\\underline{v}) = N\\sum\\limits_{\\lambda\\in{\\mathcal{E}}_{n}} |c_{\\lambda}|^{4} = N\\cdot \\|\\underline{v}\\|^{2}$, see .\\\n$\\theta = \\theta_{f_n} = \\theta(\\underline{v},\\underline{v_{0}})$: the angle between $\\underline{v}$ and the vector $\\underline{v_{0}}= (\\frac{1}{N})_{\\lambda\\in{\\mathcal{E}}_{n}}$ corresponding to Bourgain\u2019s eigenfunctions, see .\\\n$V\\left(\\underline{v} \\right)=\nN\\sum\\limits_{\\lambda\\in\\mathcal{E}_{n}}\\left|\\left|c_{\\lambda_{+}}\\right|^{2}-\\left|c_{\\lambda}\\right|^{2}\\right|$, where $\\lambda_{+}$ is the clockwise nearest neighbour of $\\lambda$ on $\\sqrt{n}\\mathcal{S}^{1}$, see .\\\n$\\widetilde{V}(\\underline{v}) = \\frac{[\\underline{v}]_{\\infty} \\cdot V(\\underline{v})}{A_{4}(\\underline{v})}$, see .\\\n${\\mathcal{F}}_{1}(n;T(n),\\eta(n)) = \\left\\{f_{n}:\\: \\widetilde{V}(\\underline{v})< \\eta(n) \\cdot \\frac{T(n)}{\\log T(n)} \\right\\}$, see .\\\n${\\mathcal{F}}_{2}(n;T(n),\\eta(n)) = \\left\\{f_{n}:\\: [\\underline{v}]_{\\infty} < T(n)^{\\eta(n)} \\right\\}$, see .\\\n$\\widehat{\\lambda}=\\lambda/\\sqrt{n}$: the projection of $\\lambda \\in \\mathcal{E}_n$ onto $\\mathcal{S}^{d-1}.$\\\n$\\Delta\\left(n\\right)=\\sup\\limits_{0\\le a\\le b\\le2\\pi}\\left|\\frac{1}{N}\\cdot \\#\\left\\{ 1\\le j\\le N:\\,\\phi_{j}\\in\\left[a,b\\right]\\,\\text{mod\\,}2\\pi\\right\\} -\\frac{\\left(b-a\\right)}{2\\pi}\\right|$: the discrepancy of the angles $ \\phi_j $ corresponding to the lattice points $ {\\mathcal{E}}_{2;n} $, see .\\\nHypothesis $ \\mathcal{D}(n,\\epsilon) $ holds if $\\Delta\\left(n\\right)\\le \\left(\\log n\\right)^{-\\frac{1}{2}\\log\\frac{\\pi}{2}+\\epsilon}$, see .\\\n$\\Delta_{3}\\left(n\\right)=\\sup\\limits_{\\begin{subarray}{c}\n    x\\in\\mathcal{S}^{2}\\\\\n    0<r\\le2\n    \\end{subarray}}\\left|\\frac{1}{N} \\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{3;n}:\\,\\left|\\widehat{\\lambda}-x\\right|\\le r\\right\\} -\\frac{r^{2}}{4}\\right|$: the spherical cap discrepancy of the points $ \\mathcal{E}_{3;n} $, see .\\\n${\\mathcal{S}}_{n}(l) = \\left\\{ (\\lambda^{1},\\ldots,\\lambda^{l})\\in({\\mathcal{E}}_{n})^{l}:\\: \\sum\\limits_{i=1}^{l}\\lambda^{i}=0  \\right\\}$: the length-$ l $ spectral correlation set, see .\\\n${\\mathcal{D}}_{n}(l) = \\left\\{ \\pi(\\lambda^{1},-\\lambda^{1},\\ldots,\\lambda^{k},-\\lambda^{k}): \\lambda^{1},\\ldots,\\lambda^{k}\\in ({\\mathcal{E}}_{n})^{k},\\,\\pi\\in S_{l}\\right\\}$: the diagonal correlations set, see .\\\n$\\mathcal{A}_n (2k) = \\left\\{\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in{\\mathcal{D}}_{n}(2k): \\; \\forall 1\\le i\\le k \\; \\lambda_{2i-1}\\ne-\\lambda_{2i} \\right\\}$: the set of \u201cadmissible\u201d $ 2k $-tuples of lattice points, see .\\\n$S\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)$: the structure set of an admissible $ 2k $-tuple $\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)$, see .\\\n$J_{\\alpha}\\left(x\\right)$: the Bessel function of the first kind of order $\\alpha$.\\\n$g_{d}\\left(x\\right)=\\frac{J_{d/2}\\left(2 \\pi x\\right)}{(2 \\pi x)^{d/2}}$: the Fourier transform of the characteristic function of the unit ball in $\\mathbb{R}^{d}$, see .\\\n$   h_{2}\\left(x\\right)=\\frac{J_{1}\\left(2 \\pi x\\right)^{2}}{(2\\pi x)^{2}}$, see .\\\n$h_{3}\\left(x\\right)=2\\pi^{-1}(2 \\pi x)^{-4}\\left(\\frac{\\sin 2 \\pi x}{2\\pi x}-\\cos 2 \\pi x\\right)^{2}$, see .\\\n$F_{\\lambda_{0}}\\left(s\\right)=\\frac{1}{N}\\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{2;n}:\\,\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda_{0}}\\right\\Vert \\le s\\right\\}$, see .\\\n$F\\left(s\\right)=F_{f_{n}}\\left(s\\right)=\\sum\\limits_{\\begin{subarray}{c}\n    \\lambda,\\lambda'\\in\\mathcal{E}_{2;n}\\\\\n    0<\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\n    \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}$, see .\\\n$F_{3}\\left(s\\right)=\\frac{1}{N^{2}} \\cdot \\#\\left\\{ \\lambda\\ne\\lambda'\\in\\mathcal{E}_{3;n}:\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\}$, see .\\\n${\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}] = \\frac{1}{{\\operatorname{Vol}}(B_{x_0}(\\rho))}\\int\\limits_{B_{x_{0}}(\\rho)}X_{f_{n},r;x}dx$: the \u201crestricted\u201d expected value of $X_{f_{n},r} $, see .\\\n${\\mathcal{V}}_{x_{0},\\rho}(X_{f_{n},r}) = {\\mathbb{E}}_{x_{0},\\rho}[(X_{f_{n},r}-{\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}])^{2}]$: the restricted variance of $X_{f_{n},r} $, see .\\\n$\\mathcal{C}_{n}(l;K) =\n\\left\\{(\\lambda^{1},\\ldots,\\lambda^{l})\\in\\mathcal{E}_{n}^{l}:\\: 0 < \\left\\| \\sum\\limits_{j=1}^{l}\\lambda^{j} \\right\\| \\le K  \\right\\}$: the set of length-$l$ spectral quasi-correlations, see .\\\nHypothesis $\\mathcal{A}(n;l,\\delta)$ holds if $\\mathcal{C}_{n}(l;n^{1/2-\\delta}) = \\varnothing$, see .\n\nProof of Theorem \\[thm:VarMainGeneralized\\], part 1: asymptotics for the variance, $d=2$. {#sec:Proof_Main_thm_part1}\n=========================================================================================\n\nExpressing the variance\n-----------------------\n\nWe begin with some preliminary expressions for the variance. Note that if $x$ is drawn randomly, uniformly on $\\mathbb{T}^{d}$, then $$\\mathbb{E}\\left[X_{f_{n},r}\\right]=\\frac{\\pi^{d/2}}{\\Gamma\\left(d/2+1\\right)}r^{d},\\label{eq:ExpectationEquality}$$ and therefore in this case, we have $$\\label{eq:variance_integral_form}\n{\\mathcal{V}}(X_{f_{n},r}) = \\int\\limits_{{\\mathbb{T}}^{d}}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y- \\frac{\\pi^{d/2}}{\\Gamma\\left(d/2+1\\right)}r^{d} \\right)^{2}dx.$$ Let $J_{\\alpha}\\left(x\\right)$ be the Bessel function of the first kind of order $\\alpha$. The following lemma, proved in section \\[sec:AuxLemmasProof\\], explicates the inner integral in :\n\n\\[lem:InnerIntegral\\]We have $$\\begin{aligned}\n    & \\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\frac{\\pi^{d/2}}{\\Gamma\\left(d/2+1\\right)}r^{d} =\\left(2\\pi\\right)^{d/2}r^{d}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}c_{\\lambda}\\overline{c_{\\lambda'}}e\\left(\\left\\langle x,\\lambda-\\lambda'\\right\\rangle \\right)g_{d}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right),\\label{eq:IntegrandVar}\n    \\end{aligned}$$ where $$\\label{eq:g_d}\n    g_{d}\\left(x\\right):=\\frac{J_{d/2}\\left(2 \\pi x\\right)}{(2 \\pi x)^{d/2}}$$ is the Fourier transform of the characteristic function of the unit ball in $\\mathbb{R}^{d}$.\n\nThe following formula for the variance follows from Lemma \\[lem:InnerIntegral\\], and :\n\n\\[lem:VarExpd2\\]\u00a0\n\n1.  (Granville-Wigman [@GranvilleWigman Lemma 2.1]) For $d=2$ we have $$\\label{eq:VarFormula2d}\n            \\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)=8\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n                \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n                \\lambda\\ne\\lambda'\n                \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}h_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)$$ where $$\\label{eq:h_2}\n            h_{2}\\left(x\\right):=\\frac{J_{1}\\left(2 \\pi x\\right)^{2}}{(2\\pi x)^{2}}.$$\n\n2.  For $d=3$ and for every $\\epsilon>0$, we have $$\\begin{aligned}\n            \\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right) & =16\\pi^{3}r^{6}\\sum_{\\begin{subarray}{c}\n                \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n                \\lambda\\ne\\lambda'\n                \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}h_{3}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)\\label{eq:VarFormula3d}\\\\\n            & +O\\left([\\underline{v}]_{\\infty}^2 r^{6}N^{-1/4+\\epsilon}\\right),\\nonumber\n            \\end{aligned}$$ where $$\\label{eq:h_3}\n            h_{3}\\left(x\\right):=2\\pi^{-1}(2 \\pi x)^{-4}\\left(\\frac{\\sin 2 \\pi x}{2\\pi x}-\\cos 2 \\pi x\\right)^{2}.$$\n\nNote that functions $g_{2}$ and $h_{2}$ satisfy the following properties:\n\n\\[lem:H2Formulas\\]We have\n\n1.  $\\int_{0}^{\\infty}h_{2}\\left(s\\right)\\,\\text{d}s=\\frac{2}{3\\pi^2}$.\n\n2.  $g_{2}\\left(s\\right)\\sim\\frac{1}{2}\\hspace{1em}\\left(s\\to0\\right)$.\n\n3.  $g_{2}\\left(s\\right)\\ll s^{-3/2}\\hspace{1em}\\left(s\\to\\infty\\right)$.\n\n4.  $g_{2}'\\left(s\\right)=-\\frac{J_{2}\\left(2\\pi s\\right)}{s}\\ll\\left(1+s\\right)^{-3/2}.$\n\nProof of Theorem \\[thm:VarMainGeneralized\\], part 1:\n----------------------------------------------------\n\nFor $\\lambda\\in\\mathcal{E}_{n}$ let $\\widehat{\\lambda}=\\lambda/\\sqrt{n}$ be the projection of $\\lambda$ onto the unit circle $\\mathcal{S}^{1}.$\n\n1.  For $ \\lambda_0 \\in \\mathcal{E}_n $ and $0\\le s\\le2$, denote $$\\label{eq:F_Lambda_Def}\n            F_{\\lambda_{0}}\\left(s\\right)=\\frac{1}{N}\\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda_{0}}\\right\\Vert \\le s\\right\\} .$$\n\n2.  For $0\\le s\\le2$ denote $$F\\left(s\\right)=F_{f_{n}}\\left(s\\right)=\\sum_{\\begin{subarray}{c}\n            \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n            0<\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\n            \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}.\\label{eq:F_Function}$$\n\nRecall that $\\widetilde{V}(\\underline{v})=\\cos^{2}\\theta \\cdot [\\underline{v}]_{\\infty} V(\\underline{v})$ by and .\n\n\\[prop:DiscreteProp\\]We have $$\\begin{aligned}\n    F\\left(s\\right) & =\\frac{s}{\\pi\\cos^{2}\\theta}\\left(1+O\\left(s^{2}+s^{-1}\\Delta\\left(n\\right)+\\widetilde{V}(\\underline{v}) s+\\widetilde{V}(\\underline{v}) s^{-1}\\Delta\\left(n\\right)^{2}\\right)\\right).\n    \\end{aligned}$$\n\nWe postpone the proof of Proposition \\[prop:DiscreteProp\\] until section \\[sec:ProofOfLemmaDiscrete\\] to present the proof of the first part of Theorem \\[thm:VarMainGeneralized\\] (that yields the first part of Theorem \\[thm:VarMain\\]):\n\nAssume that $ n\\in S_2 $ satisfies the hypothesis $ \\mathcal{D}(n,\\epsilon/2) $. We may rewrite (\\[eq:VarFormula2d\\]) as $$\\mathcal{V}\\left(X_{f_{n},r}\\right)=8\\pi^{2}r^{4}\\int_{0}^{2}h_{2}\\left(Ts\\right)\\,\\text{d}F\\left(s\\right).\\label{eq:VarianceintegralForm}$$ We apply integration by parts to (\\[eq:VarianceintegralForm\\]) twice, in opposite directions: first, by integration by parts and Proposition \\[prop:DiscreteProp\\], we get $$\\begin{aligned}\n    8\\pi^{2}r^{4}\\int_{0}^{2}h_{2}\\left(Ts\\right)\\,\\text{d}F\\left(s\\right) & =8\\pi^{2}r^{4}h_{2}\\left(2T\\right)F\\left(2\\right)-8\\pi^{2}r^{4}\\int_{0}^{2}F\\left(s\\right)\\,\\text{d}h_{2}\\left(Ts\\right)\\label{eq:VarEqAfterIntByParts}\\\\\n    & =8\\pi^{2}r^{4}h_{2}\\left(2T\\right)F\\left(2\\right)-8\\pi r^{4}\\cos^{-2}\\theta\\int_{0}^{2}s\\,\\text{d}h_{2}\\left(Ts\\right)\\nonumber \\\\\n    & +Err\\left(X_{f_n,r}\\right)\\nonumber\n    \\end{aligned}$$ where $$\\begin{aligned}\n    & Err\\left(X_{f_n,r}\\right)\\ll r^{4}\\cos^{-2}\\theta\\int_{0}^{2}\\left(s^{3}+\\Delta\\left(n\\right)+\\widetilde{V}(\\underline{v}) s^{2}+\\widetilde{V}(\\underline{v})\\Delta\\left(n\\right)^{2}\\right)T\\left|h_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s.\n    \\end{aligned}$$ Integrating by parts again, the first two terms on the r.h.s of (\\[eq:VarEqAfterIntByParts\\]) satisfy $$\\begin{aligned}\n    & 8\\pi^{2}r^{4}h_{2}\\left(2T\\right)F\\left(2\\right)-8\\pi r^{4}\\cos^{-2}\\theta\\int_{0}^{2}s\\,\\text{d}h_{2}\\left(Ts\\right)=8\\pi^{2}r^{4}h_{2}\\left(2T\\right)F\\left(2\\right)\\label{eq:MainTermsVar}\\\\\n    & -16\\pi r^{4}h_{2}\\left(2T\\right)\\cos^{-2}\\theta+8\\pi r^{4}\\cos^{-2}\\theta\\int_{0}^{2}h_{2}\\left(Ts\\right)\\,\\text{d}s.\\nonumber\n    \\end{aligned}$$ By the first and the third parts of Lemma \\[lem:H2Formulas\\], $$\\int_{0}^{2}h_{2}\\left(Ts\\right)\\,\\text{d}s=\\frac{1}{T}\\int_{0}^{2T}h_{2}\\left(s\\right)\\,\\text{d}s=\\frac{2}{3\\pi^2}T^{-1}+O\\left(T^{-3}\\right),\\label{eq:h2Integral}$$ and therefore, substituting (\\[eq:h2Integral\\]) into (\\[eq:MainTermsVar\\]), we obtain $$\\begin{aligned}\n    \\label{eq:VarianceMainTerms}\n    8\\pi^{2}r^{4}h_{2}\\left(2T\\right)F\\left(2\\right)-8\\pi r^{4}\\cos^{-2}\\theta\\int_{0}^{2}s\\,\\text{d}h_{2}\\left(Ts\\right) & =\\frac{16}{3\\pi}\\cos^{-2}\\theta r^{4}T^{-1} +O\\left(\\cos^{-2}\\theta r^{4}T^{-3}\\right).\n    \\end{aligned}$$ By the fourth part of Lemma \\[lem:H2Formulas\\], $$\\begin{aligned}\n    \\int_{0}^{2}T\\left|h_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s & =\\int_{0}^{2T}\\left|h_{2}'\\left(s\\right)\\right|\\,\\text{d}s\\le\\int_{0}^{\\infty}\\left|h_{2}'\\left(s\\right)\\right|\\,\\text{d}s<\\infty,\n    \\end{aligned}$$ $$\\int_{0}^{2}s^{2}T\\left|h_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s=T^{-2}\\int_{0}^{2T}s^{2}\\left|h_{2}'\\left(s\\right)\\right|\\,\\text{d}s\\ll T^{-2}\\log T$$ and $$\\int_{0}^{2}s^{3}T\\left|h_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s=T^{-3}\\int_{0}^{2T}s^{3}\\left|h_{2}'\\left(s\\right)\\right|\\,\\text{d}s\\ll T^{-2},$$ and therefore for $ n $ satisfying $ \\mathcal{D}(n,\\epsilon/2), $ $$\\begin{aligned}\n    Err\\left(X_{f_n,r}\\right) & \\ll\\cos^{-2}\\theta r^{4}\\left(T^{-2}+\\Delta\\left(n\\right)+\\widetilde{V}(\\underline{v}) T^{-2}\\log T+\\widetilde{V}(\\underline{v})\\Delta\\left(n\\right)^{2}\\right)\\nonumber \\\\\n    & \\ll\\cos^{-2}\\theta r^{4}\\left(T^{-2}+\\left(\\log n\\right)^{-\\frac{1}{2}\\log\\frac{\\pi}{2}+\\frac{\\epsilon}{2}}+\\widetilde{V}(\\underline{v}) T^{-2}\\log T+\\widetilde{V}(\\underline{v})\\left(\\log n\\right)^{-\\log\\frac{\\pi}{2}+\\epsilon}\\right),\\label{eq:ErrorTerm}\n    \\end{aligned}$$ and follows from , and .\n\nNote that by (\\[eq:ErrorTerm\\]), for Bourgain\u2019s eigenfunctions, for almost all $n\\in S_{2}$ we have $$\\sup_{\\begin{subarray}{c}\n    r > r_{0} \\\\ f_n\\in {\\mathcal{B}}{n}\n    \\end{subarray}}\\left|\\frac{\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)}{r^{4}}-\\frac{16}{3\\pi}T^{-1}\\right|=O\\left(T_{0}^{-2}+\\left(\\log n\\right)^{-\\frac{1}{2}\\log\\frac{\\pi}{2}+\\epsilon}\\right)$$ for every $\\epsilon>0$, and in particular $$\\label{eq:o_r4_2d}\n\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)=o\\left(r^{4}\\right)$$ uniformly for $r > r_{0}$ for a density one sequence in $S_{2}$. Therefore, serves as a refinement of [@GranvilleWigman Corollary 1.10] for this specific case (for a density one sequence in $S_{2}$), since [@GranvilleWigman Corollary 1.10] yields $\\mathcal{V}\\left(X_{f_n,r}\\right)=o\\left(r^{4}\\right)$ under the additional assumption $T_{0}\\gg n^{4\\epsilon}$.\n\nProof of Proposition \\[prop:DiscreteProp\\] {#sec:ProofOfLemmaDiscrete}\n------------------------------------------\n\nIn this section we prove Proposition \\[prop:DiscreteProp\\]. First, we define a binary relation on $\\mathcal{E}_n$:\n\nfor $\\lambda\\ne-\\lambda'\\in\\mathcal{E}_{n}$, we say that $\\lambda\\prec\\lambda'$ if the arc on the circle $\\sqrt{n}\\mathcal{S}^{1}$ that connects $\\lambda$ to $\\lambda'$ counter-clockwise to $\\lambda'$ is shorter than the arc that connects them clockwise to $\\lambda'$. Recall that $\\lambda_{+}$ is the clockwise nearest neighbour of $\\lambda$ on $\\sqrt{n}\\mathcal{S}^{1}$. The proof of Proposition \\[prop:DiscreteProp\\] employs the following auxiliary lemma to be proved at section \\[sec:AuxLemmasProof\\], establishing (\\[eq:F\\_Function\\]) in the particular case $\\left|c_{\\lambda}\\right|^{2}=1$ for every $\\lambda\\in\\mathcal{E}_{n}$:\n\n\\[lem:CosToDist\\]\n\nFix $\\lambda'\\in\\mathcal{E}_{n}.$ For $0\\le s<2$, we have $$\\frac{1}{N}\\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\lambda\\succeq\\lambda',\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\} =\\frac{s}{2\\pi}+O\\left(s^{3}+\\Delta\\left(n\\right)\\right)\\label{eq:CosToDistEq}$$ where the constant involved in the \u2019O\u2019-notation in (\\[eq:CosToDistEq\\]) is absolute.\n\nThe estimate (\\[eq:CosToDistEq\\]) is also valid with either \u2018$\\succ$\u2019, \u2018$\\preceq$\u2019 or \u2018$\\prec$\u2019 in place of \u2018$\\succeq$\u2019.\n\nWe are now in a position to prove Proposition \\[prop:DiscreteProp\\]:\n\nFirst, we write $$\\begin{aligned}\n    F\\left(s\\right) & =\\sum_{\\lambda'\\in\\mathcal{E}_{n}}\\left|c_{\\lambda'}\\right|^{2}\\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\preceq\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}+\\sum_{\\lambda'\\in\\mathcal{E}_{n}}\\left|c_{\\lambda'}\\right|^{2}\\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\succeq\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\label{eq:PartialSummation} +O\\left(\\frac{A_{4}}{N}\\right).\n    \\end{aligned}$$ Using summation by parts, we get that for every $\\lambda'\\in\\mathcal{E}_{n}$ $$\\begin{aligned}\n    \\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\preceq\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2} & =\\left|c_{\\lambda'}\\right|^{2} \\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\lambda\\preceq\\lambda',\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\} \\label{eq:PartialSumEq}\\\\\n    & -\\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\prec\\lambda'\n        \\end{subarray}}\\left(\\left|c_{\\lambda_{+}}\\right|^{2}-\\left|c_{\\lambda}\\right|^{2}\\right) \\cdot \\#\\left\\{ \\mu\\in\\mathcal{E}_{n}:\\,\\mu\\preceq\\lambda,\\,\\left\\Vert \\widehat{\\mu}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\} .\\nonumber\n    \\end{aligned}$$ By Lemma \\[lem:CosToDist\\], the contribution of the first term on the r.h.s of (\\[eq:PartialSumEq\\]) to $F\\left(s\\right)$ is $$\\begin{aligned}\n    \\label{eq:first_term_discrete}\n     \\sum_{\\lambda'\\in\\mathcal{E}_{n}}\\left|c_{\\lambda'}\\right|^{4} \\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\lambda\\preceq\\lambda',\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\}\n     =A_{4} \\cdot\n    \\left(s/2\\pi+O\\left(s^{3}+\\Delta\\left(n\\right)\\right)\\right).\n    \\end{aligned}$$ The contribution of the sum on the r.h.s of (\\[eq:PartialSumEq\\]) to $F\\left(s\\right)$ is $$\\begin{aligned}\n    \\label{eq:second_term_discrete}\n    & \\sum_{\\lambda'\\in\\mathcal{E}_{n}}\\left|c_{\\lambda'}\\right|^{2}\\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\prec\\lambda'\n        \\end{subarray}}\\left(\\left|c_{\\lambda_{+}}\\right|^{2}-\\left|c_{\\lambda}\\right|^{2}\\right) \\cdot \\#\\left\\{ \\mu\\in\\mathcal{E}_{n}:\\,\\mu\\preceq\\lambda,\\,\\left\\Vert \\widehat{\\mu}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\} \\\\\n    & \\ll N\\left(s+\\Delta\\left(n\\right)\\right)\\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\end{subarray}}\\left|\\left|c_{\\lambda_{+}}\\right|^{2}-\\left|c_{\\lambda}\\right|^{2}\\right|\\sum_{\\begin{subarray}{c}\n        \\lambda'\\in\\mathcal{E}_{n} \\nonumber \\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\prec\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda'}\\right|^{2}\\ll\\left(s+\\Delta\\left(n\\right)\\right)^{2}[\\underline{v}]_{\\infty} V(\\underline{v}) .\n    \\end{aligned}$$ By and , we have $$\\label{eq:first_summation_discrete}\n    \\sum_{\\begin{subarray}{c}\n        \\lambda\\in\\mathcal{E}_{n}\\\\\n        \\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\\\\n        \\lambda\\preceq\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2} = A_{4} \\cdot\n    \\left(s/2\\pi+O\\left(s^{3}+\\Delta\\left(n\\right)\\right)\\right) + O\\left(\\left(s+\\Delta\\left(n\\right)\\right)^{2}[\\underline{v}]_{\\infty}V(\\underline{v}) \\right).$$ By symmetry, the second summation in (\\[eq:PartialSummation\\]) obeys with \u2018$ \\succ $\u2019, \u2018$ \\succeq $\u2019 and $ |c_{\\lambda_-}|^2 $ in place of \u2018$ \\prec $\u2019, \u2018$ \\preceq $\u2019 and $ |c_{\\lambda_+}|^2 $, where $ \\lambda_- $ is the counter-clockwise nearest neighbour to $ \\lambda $. The statement of Proposition \\[prop:DiscreteProp\\] follows from the analogues of the estimates , and .\n\nProof of Theorem \\[thm:VarMainGeneralized\\], part 2: Gaussian moments, $d=2$. {#sec:Proof_Main_thm_part2}\n=============================================================================\n\nIn this section we study the higher moments of $\\hat{X}_{f_{n},r}$ defined in , and prove the second part of Theorem \\[thm:VarMainGeneralized\\], also implying the second part of Theorem \\[thm:VarMain\\].\n\nThe proof of the following lower bound for $ {\\mathcal{V}}\\left(X_{f_{n},r}\\right) $ with $f_{n}\\in {\\mathcal{F}}_{2}(n;T(n),\\eta(n))$ goes along the same lines as the proof of the lower bound in Theorem \\[thm:UpperBound2d\\] below:\n\n\\[lem:Lower\\_Bound\\_F2\\] In the setting of Theorem \\[thm:VarMainGeneralized\\] part (2), we have $$\\frac{{\\mathcal{V}}(X_{f_n,r})}{r^{4}} \\gg T(n)^{-1-2\\eta(n)}$$ uniformly for $r_{0} < r < r_1$ and $f_{n}\\in {\\mathcal{F}}_{2}(n;T(n),\\eta(n))$.\n\nBefore proceeding to the proof of Theorem \\[thm:VarMainGeneralized\\], we introduce some notation:\n\n1.  Define the set of \u201cadmissible\u201d $2k$-tuples of lattice points by $$\\label{eq:admissible_tuples}\n            \\mathcal{A}_n (2k) = \\left\\{\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in{\\mathcal{D}}_{n}(2k): \\; \\forall 1\\le i\\le k \\; \\lambda_{2i-1}\\ne-\\lambda_{2i} \\right\\}.$$\n\n2.  Given an admissible $2k$-tuple of lattice points $\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in \\mathcal{A}_n (2k)$, let $\\sim$ be the equivalence relation on the set $\\left\\{ 1,\\dots,2k\\right\\} $, generated by:\n\n    1.  $2i-1\\sim2i$ for every $1\\le i\\le k$.\n\n    2.  $j\\sim j'$ if $\\lambda_{j}+\\lambda_{j}'=0.$\n\n    Let $\\left\\{ \\Lambda_{1},\\dots,\\Lambda_{m}\\right\\} $ be the partition of $\\left\\{ 1,\\dots,2k\\right\\} $ into equivalence classes of $\\sim$, and denote $l_{j}=\\#\\Lambda_{m}/2$ for $1\\le j\\le m$, so that $\\sum_{j=1}^{m}l_{j}=k$; clearly, $2\\le l_{j}\\in\\mathbb{Z}$ for every $1\\le j\\le m$. We call the multiset $$\\label{eq:structure_set}\n            S\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right):=\\left\\{ l_{1},\\dots,l_{m}\\right\\}$$ the structure set of the $2k$-tuple $\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right).$\n\nRecall that the moments of a standard Gaussian random variable $Z\\sim N(0,1)$ are $${\\mathbb{E}}[Z^{k}]=\\begin{cases}\n\\left(k-1\\right)!! & k\\,\\text{even}\\\\\n0 & k\\,\\text{odd}.\n\\end{cases}$$ We are now in a position to prove the second part of Theorem \\[thm:VarMainGeneralized\\].\n\nBy the length-$2k$ diagonal domination assumption, we have $$\\begin{aligned}\n    {\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}] & =(2\\pi)^k r^{2k}{\\mathcal{V}}\\left(X_{f_{n},r}\\right)^{-k/2}\\sum_{\\begin{subarray}{c}\n        \\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in \\mathcal{A}_n (2k)\\end{subarray}}\\label{eq:kthMoment}\\prod_{j=1}^{k}c_{\\lambda_{2j-1}}c_{\\lambda_{2j}}g_{2}\\left(r\\left\\Vert \\lambda_{2j-1}+\\lambda_{2j}\\right\\Vert \\right) \\\\ &+O\\left({\\mathcal{V}}\\left(X_{f_{n},r}\\right)^{-k/2} [\\underline{v}]_{\\infty}^k r^{2k}N^{-\\gamma}\\right)\\nonumber\n    \\end{aligned}$$ for some $ \\gamma>0. $ We can rearrange the summation in (\\[eq:kthMoment\\]), first summing over all possible structure sets $\\mathcal{L}=\\left\\{ l_{1},\\dots,l_{m}\\right\\} $ and then summing over the admissible $2k$-tuples $\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in\\mathcal{E}_{n}^{2k}$ with the given structure set $S\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)=\\mathcal{L} $: let $$\\begin{aligned}\n    S_{\\mathcal{L}} & :=\\sum_{\\begin{subarray}{c}\n        \\begin{subarray}{c}\n        \\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in \\mathcal{A}_n (2k)\\\\\n        S\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)=\\mathcal{L}\n        \\end{subarray}\\end{subarray}}\\prod_{j=1}^{k}c_{\\lambda_{2j-1}}c_{\\lambda_{2j}}g_{2}\\left(r\\left\\Vert \\lambda_{2j-1}+\\lambda_{2j}\\right\\Vert \\right),\n    \\end{aligned}$$ so that we may rewrite the summation on the r.h.s. of as $$\\begin{aligned}\n    \\label{eq:Inner_Sum_with_SL}\n    & \\sum_{\\begin{subarray}{c}\n        \\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in \\mathcal{A}_n (2k)\\end{subarray}}\\prod_{j=1}^{k}c_{\\lambda_{2j-1}}c_{\\lambda_{2j}}g_{2}\\left(r\\left\\Vert \\lambda_{2j-1}+\\lambda_{2j}\\right\\Vert \\right)=\\sum_{\\begin{subarray}{c}\n        l_{1}+\\dots+l_{m}=k\\\\\n        l_{1},\\dots,l_{m}\\ge2\n        \\end{subarray}}\\sum_{\\begin{subarray}{c}\n        \\begin{subarray}{c}\n        \\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)\\in \\mathcal{A}_n (2k)\\\\\n        S\\left(\\lambda_{1},\\dots,\\lambda_{2k}\\right)=\\mathcal{L}\n        \\end{subarray}\\end{subarray}}S_{\\mathcal{L}}.\n    \\end{aligned}$$ For a fixed structure set $\\mathcal{L}=\\left\\{ l_{1},\\dots,l_{m}\\right\\} $, we have $$\\begin{aligned}\n    S_{\\mathcal{L}} =a\\left(\\mathcal{L}\\right)\\prod_{j=1}^{m}\\sum_{\\lambda_{1},\\dots,\\lambda_{l_{j}}\\in\\mathcal{E}_{n}}\\left|c_{\\lambda_{1}}\\right|^{2}g_{2}\\left(r\\left\\Vert \\lambda_{l_{j}}-\\lambda_{1}\\right\\Vert \\right)\\label{eq:RearrangeInPartition}\\prod_{i=1}^{l_{j}-1}\\left|c_{\\lambda_{i+1}}\\right|^{2}g_{2}\\left(r\\left\\Vert \\lambda_{i}-\\lambda_{i+1}\\right\\Vert \\right)+O\\left([\\underline{v}]_{\\infty}^k N^{-1}\\right)\n    \\end{aligned}$$ where $a\\left(\\mathcal{L}\\right)$ is a constant depending on $\\mathcal{L}$; omitting the condition that the lattice points are distinct on the r.h.s of (\\[eq:RearrangeInPartition\\]) is absorbed within the error term in (\\[eq:RearrangeInPartition\\]). Thus, $$\\begin{aligned}\n    \\label{eq:SL_upper_bound}\n    S_{\\mathcal{L}} & \\ll [\\underline{v}]_{\\infty}^k N^{-k}\\prod_{j=1}^{m}\\sum_{\\lambda_{1}\\in\\mathcal{E}_{n}}\\sum_{\\lambda_{2}\\in\\mathcal{E}_{n}}\\left|g_{2}\\left(r\\left\\Vert \\lambda_{2}-\\lambda_{1}\\right\\Vert \\right)\\right|\\cdots\\sum_{\\lambda_{l_{j}}\\in\\mathcal{E}_{n}}\\left|g_{2}\\left(r\\left\\Vert \\lambda_{l_{j}-1}-\\lambda_{l_{j}}\\right\\Vert \\right)\\right|+[\\underline{v}]_{\\infty}^k N^{-1}.\n    \\end{aligned}$$ Recall the definition of $ F_{\\lambda_0} $ in . By Lemma \\[lem:CosToDist\\], we have $$\\label{eq:f_lambda_zero}\n    F_{\\lambda_{0}}\\left(s\\right)=\\frac{s}{\\pi}+O\\left(s^{3}+\\Delta\\left(n\\right)\\right)=O\\left(s+\\Delta\\left(n\\right)\\right).$$ Thus, by Lemma \\[lem:H2Formulas\\] and , we have that $$\\begin{aligned}\n    \\label{eq:abs_g2_bound}\n    \\frac{1}{N}\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|g_{2}\\left(r\\left\\Vert \\lambda-\\lambda_{0}\\right\\Vert \\right)\\right| & =\\int_{0}^{2}\\left|g_{2}\\left(Ts\\right)\\right|\\,\\text{d}F_{\\lambda_{0}}\\left(s\\right)\\\\\n    & =\\left|g_{2}\\left(2T\\right)\\right|-\\frac{1}{2N}+O\\left(\\int_{0}^{2}\\left(s+\\Delta\\left(n\\right)\\right)T\\left|g_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s\\right) \\nonumber \\\\\n    & =O\\left(T^{-3/2}+\\left(\\Delta\\left(n\\right)+T^{-1}\\right)\\int_{0}^{2T}\\left|g_{2}'\\left(s\\right)\\right|\\,\\text{d}s\\right) \\nonumber \\\\\n    & =O\\left(T^{-1}\\right) \\nonumber\n    \\end{aligned}$$ for $ n $ satisfying the hypothesis $ \\mathcal{D}(n,\\epsilon) $. Applying to each of the $l_{j}-1$ inner summations in , we obtain\n\n$$\\begin{aligned}\n    S_{\\mathcal{L}} & \\ll [\\underline{v}]_{\\infty}^k N^{-k+m}\\prod_{j=1}^{m}\\left(NT^{-1}\\right)^{l_{j}-1} + [\\underline{v}]_{\\infty}^k N^{-1} \\ll [\\underline{v}]_{\\infty}^k T^{-k+m}.\n    \\end{aligned}$$\n\nLet $ \\mathcal{L}_0 = \\left\\{ 2,2,\\dots2,\\right\\} $. Note that if $\\mathcal{L}\\ne \\mathcal{L}_0 $ then $m\\le\\frac{k-1}{2}$ and therefore $$\\label{eq:SL_Estimate}\n        S_{\\mathcal{L}}=O\\left([\\underline{v}]_{\\infty}^k T^{-\\frac{k+1}{2}}\\right).$$ If $\\mathcal{\\mathcal{L}}=\\mathcal{L}_0 $ (this is a viable option for $k$ even), then $$\\label{eq:SL_formula}\n    S_{\\mathcal{L}_0}=2^{k/2}\\left(k-1\\right)!!\\left[\\sum_{\\lambda_{1}\\ne\\lambda_{2}\\in\\mathcal{E}_{n}}\\left|c_{\\lambda_{1}}\\right|^{2}\\left|c_{\\lambda_{2}}\\right|^{2}h_{2}\\left(r\\left\\Vert \\lambda_{1}-\\lambda_{2}\\right\\Vert \\right)\\right]^{k/2}+O\\left([\\underline{v}]_{\\infty}^k N^{-1}\\right).$$ By (\\[eq:VarFormula2d\\]), $$\\label{eq:SL_Variance_asympt}\n    \\sum_{\\lambda_{1}\\ne\\lambda_{2}\\in\\mathcal{E}_{n}}\\left|c_{\\lambda_{1}}\\right|^{2}\\left|c_{\\lambda_{2}}\\right|^{2}h_{2}\\left(r\\left\\Vert \\lambda_{1}-\\lambda_{2}\\right\\Vert \\right)=\\frac{{\\mathcal{V}}\\left(X_{f_{n},r}\\right)}{8\\pi^2 r^4}.$$ Hence, and yield $$\\label{eq:SL_final_form}\n    S_{\\mathcal{L}_0}=\\left(k-1\\right)!!\\left(\\frac{{\\mathcal{V}}\\left(X_{f_{n},r}\\right)}{4\\pi^2r^4}\\right)^{k/2}+O\\left([\\underline{v}]_{\\infty}^k N^{-1}\\right).$$ Substituting and into and applying Lemma \\[lem:Lower\\_Bound\\_F2\\], we finally obtain that for $k$ even $$\\begin{aligned}\n    \\left|{\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}]-\\left(k-1\\right)!!\\right| & \\ll T^{k\\eta(n)} [\\underline{v}]_{\\infty}^k\\left(T^{-1/2}+T^{k/2}N^{-\\min\\{1,\\gamma \\}}\\right) \\ll T^{-1/2+2k\\eta(n)}\n    \\end{aligned}$$ and since for $k$ odd $ \\mathcal{L}=\\mathcal{L}_0 $ is not a viable option, we obtain $$\\begin{aligned}\n{\\mathbb{E}}[\\hat{X}_{f_{n},r}^{k}] & \\ll T^{k\\eta(n)} [\\underline{v}]_{\\infty}^k\\left(T^{-1/2}+T^{k/2}N^{-\\min\\{1,\\gamma \\}}\\right) \\ll  T^{-1/2+2k\\eta(n) },\n    \\end{aligned}$$ and the second part of Theorem \\[thm:VarMainGeneralized\\] follows.\n\nProof of Theorem \\[thm:Var3D\\]: asymptotics for the variance, $d=3$ {#sec:Proof_3d_theorem}\n===================================================================\n\nProof of Theorem \\[thm:Var3D\\]\n------------------------------\n\nDenote $$\\label{eq:F_3}\nF_{3}\\left(s\\right)=\\frac{1}{N^{2}} \\cdot \\#\\left\\{ \\lambda\\ne\\lambda'\\in\\mathcal{E}_{n}:\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\}$$(cf. ), and recall that the spherical cap discrepancy for the points in $\\mathcal{E}_{n}$ is defined by $$\\label{eq:Discrepancy_3d}\n\\Delta_{3}\\left(n\\right)=\\sup_{\\begin{subarray}{c}\n    x\\in\\mathcal{S}^{2}\\\\\n    0<r\\le2\n    \\end{subarray}}\\left|\\frac{1}{N} \\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\left|\\widehat{\\lambda}-x\\right|\\le r\\right\\} -\\frac{r^{2}}{4}\\right|.$$\n\n\\[cor:DistMeasure3d\\]We have $$\\label{eq:3d_Discrepancy}\n    F_{3}\\left(s\\right)=\\frac{s^{2}}{4}+O\\left(\\Delta_{3}\\left(n\\right)\\right).$$\n\nThe estimate follows immediately from the definition of spherical cap discrepancy, since $$\\begin{aligned}\n    F_{3}\\left(s\\right) & =\\frac{1}{N}\\sum_{\\lambda'\\in\\mathcal{E}_{n}}\\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,0<\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\}  =\\frac{s^{2}}{4}+O\\left(\\Delta_{3}\\left(n\\right)\\right).\n    \\end{aligned}$$\n\nThe discrepancy $\\Delta_{3}\\left(n\\right)$ satisfies $ \\Delta_3(n) \\le n^{-\\eta} $ for some small $\\eta>0$, see [@BourgainRudnickSarnak]. We are now in a position to prove Theorem \\[thm:Var3D\\]:\n\nBy we have $$\\begin{aligned}\n    \\label{eq:var_3d_asymp_formula}\n    \\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_n,r}\\right) & =16\\pi^{3}r^{6}\\frac{1}{N^{2}}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}h_{3}\\left(T\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\right)+O\\left(r^{6}N^{-1/4+\\epsilon}\\right).\n    \\end{aligned}$$ For the summation in we have, $$\\frac{1}{N^{2}}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}h_{3}\\left(T\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\right)=\\int_{0}^{2}h_{3}\\left(Ts\\right)\\,\\text{d}F_{3}\\left(s\\right).$$ Thus, integrating by parts and using Lemma \\[cor:DistMeasure3d\\], $$\\begin{aligned}\n    \\frac{1}{N^{2}}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}h_{3}\\left(T\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\right) & =h_{3}\\left(2T\\right)F_{3}\\left(2\\right)-\\int_{0}^{2}F_{3}\\left(s\\right)\\,\\text{d}h_{3}\\left(Ts\\right)\\label{eq:VarAftIntParts3D}\\\\\n    & =h_{3}\\left(2T\\right)F_{3}\\left(2\\right)-\\frac{1}{4}\\int_{0}^{2}s^{2}\\,\\text{d}h_{3}\\left(Ts\\right)+Err\\left(X_{f_n,r}\\right)\\nonumber\n    \\end{aligned}$$ where $$\\label{eq:error_term_3d}\n    Err\\left(X_{f_n,r}\\right)\\ll\\Delta_{3}\\left(n\\right)\\int_{0}^{2}T\\left|h_{3}'\\left(Ts\\right)\\right|\\,\\text{d}s.$$ Note that $h_{3}\\left(s\\right)\\ll s^{-4}$ as $s\\to\\infty.$ Thus, integrating by parts, the main term on the r.h.s of (\\[eq:VarAftIntParts3D\\]) satisfies $$\\label{eq:main_terms_after_intbyparts_3d}\n    h_{3}\\left(2T\\right)F_{3}\\left(2\\right)-\\frac{1}{4}\\int_{0}^{2}s^{2}\\,\\text{d}h_{3}\\left(Ts\\right)=\\frac{1}{2}\\int_{0}^{2}s \\cdot h_{3}\\left(Ts\\right)\\,\\text{d}s+O\\left(T^{-4}\\right),$$ so that $$\\label{eq:main_int_after_intbyparts}\n    \\int_{0}^{2}s \\cdot h_{3}\\left(Ts\\right)\\,\\text{d}s=\\frac{1}{T^{2}}\\int_{0}^{2T}s \\cdot h_{3}\\left(s\\right)\\,\\text{d}s=\\frac{1}{T^{2}}\\int_{0}^{\\infty}s \\cdot h_{3}\\left(s\\right)\\,\\text{d}s+O\\left(T^{-4}\\right).$$ A direct computation shows that $$\\label{eq:final_calc_main_term_3d}\n    \\int_{0}^{\\infty}s \\cdot h_{3}\\left(s\\right)\\,\\text{d}s=\\frac{1}{2\\pi^3}\\int_{0}^{\\infty}\\frac{1}{s^{3}}\\left(\\frac{\\sin s}{s}-\\cos s\\right)^{2}\\,\\text{d}s=\\left(2\\pi\\right)^{-3},$$ and therefore, substituting into and then into we get $$\\label{eq:main_term_final_form_3d}\n    h_{3}\\left(2T\\right)F_{3}\\left(2\\right)-\\frac{1}{4}\\int_{0}^{2}s^{2}\\,\\text{d}h_{3}\\left(Ts\\right)=\\frac{1}{16\\pi^3}T^{-2}+O\\left(T^{-4}\\right).$$ Note that $h_{3}'\\left(s\\right)\\ll\\left(1+s^{4}\\right)^{-1}$. Thus, $$\\label{eq:err_upper_bound_3d}\n    \\int_{0}^{2}T\\left|h_{3}'\\left(Ts\\right)\\right|\\,\\text{d}s=\\int_{0}^{2T}\\left|h_{3}'\\left(s\\right)\\right|\\,\\text{d}s\\le\\int_{0}^{\\infty}\\left|h_{3}'\\left(s\\right)\\right|\\,\\text{d}s<\\infty$$ and therefore, substituting into we obtain $$Err\\left(X_{f_n,r}\\right)=O\\left(\\Delta_{3}\\left(n\\right)\\right).\\label{eq:3DErrorVar}$$ Substituting into and finally into we obtain (\\[eq:AympVar3D\\]).\n\nNote that by (\\[eq:3DErrorVar\\]), $$\\sup_{\\begin{subarray}{c}\n    r > r_{0} \\\\ f_n\\in {\\mathcal{B}}{n}\n    \\end{subarray}}\\left|\\frac{\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)}{r^{6}}-T^{-2}\\right|=O\\left(T_{0}^{-4}+n^{-\\eta}\\right)$$ for every $n\\not\\equiv0,4,7\\,\\left(8\\right)$, and in particular $$\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right)=o\\left(r^{6}\\right)$$ uniformly for $r > r_{0}$ for every $n\\not\\equiv0,4,7\\,\\left(8\\right)$.\n\nProofs of Theorem \\[thm:UpperBound2d\\] and Theorem \\[thm:UpperBound3d\\] {#sec:ProofOfBoundsThm}\n=======================================================================\n\nBy substituting the bound $\\left|c_{\\lambda}\\right|^{2}\\le N^{-1+\\epsilon}$ into (\\[eq:VarFormula2d\\]), we have\n\n$$\\begin{aligned}\n\\label{eq:var_ultraflat_bound}\n\\text{\\ensuremath{\\mathcal{V}}}\\left(X_{f_{n},r}\\right) & \\ll r^{4} N^{-1+\\epsilon}\\sum_{\\lambda_0 \\in \\mathcal{E}_n}\\left|c_{\\lambda_0}\\right|^{2}\\sum_{\\lambda \\in \\mathcal{E}_n} h_{2}\\left(r\\left\\Vert \\lambda-\\lambda_0\\right\\Vert \\right).\\end{aligned}$$\n\nBy Lemma \\[lem:H2Formulas\\] and by , we have $$\\begin{aligned}\n\\label{eq:H2_sum}\n\\frac{1}{N}\\sum_{\\lambda\\in\\mathcal{E}_{n}}h_{2}\\left(r\\left\\Vert \\lambda-\\lambda_{0}\\right\\Vert \\right) & =\\int_{0}^{2}h_{2}\\left(Ts\\right)\\,\\text{d}F_{\\lambda_{0}}\\left(s\\right)\\\\\n& =h_{2}\\left(2T\\right)-\\frac{1}{4N}+O\\left(\\int_{0}^{2}\\left(s+\\Delta\\left(n\\right)\\right)T\\left|h_{2}'\\left(Ts\\right)\\right|\\,\\text{d}s\\right) \\nonumber \\\\\n& =O\\left(T^{-1}+\\left(\\log n\\right)^{-\\frac{1}{2}\\log\\frac{\\pi}{2}+\\epsilon}\\right) \\nonumber\\end{aligned}$$ for $ n $ satisfying the hypothesis $ \\mathcal{D}(n,\\epsilon) $. Substituting in , we get the upper bound in Theorem \\[thm:UpperBound2d\\]. The upper bound in Theorem \\[thm:UpperBound3d\\] follows along similar lines.\n\nWe now turn to proving the claimed lower bounds for the variance of $X_{f_n,r}$. First, we need the following lemma, proved at the end of section \\[sec:ProofOfBoundsThm\\]:\n\n\\[lem:LowerBoundPairs\\]\n\n1.  Let $\\left\\{ x_{m}\\right\\} _{m=1}^{M}$ be $M$ points on the unit circle $\\mathcal{S}^{1}.$ For every $1<T<M/2$ we have $$\\#\\left\\{ x_{i}\\ne x_{j}:\\,\\left|x_{i}-x_{j}\\right|\\le1/T\\right\\} \\gg M^{2}/T.$$\n\n2.  Let $\\left\\{ x_{m}\\right\\} _{m=1}^{M}$ be $M$ points on the unit sphere $S^{2}.$ For every $1<T<\\sqrt{M}/2$ we have $$\\#\\left\\{ x_{i}\\ne x_{j}:\\,\\left|x_{i}-x_{j}\\right|\\le1/T\\right\\} \\gg M^{2}/T^{2}.$$\n\nWe are now in a position to prove the lower bounds , of Theorem \\[thm:UpperBound2d\\] and Theorem \\[thm:UpperBound3d\\]:\n\nFor $d=2$, we let $$R=\\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\left|c_{\\lambda}\\right|^{2}\\ge \\frac{1}{2N}\\right\\},$$ so that $$1=\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|^{2}=\\sum_{\\lambda\\in R}\\left|c_{\\lambda}\\right|^{2}+\\sum_{\\lambda\\notin R}\\left|c_{\\lambda}\\right|^{2}\\le N^{-1+\\epsilon} \\cdot \\#R+1/2,$$ and hence $\\#R\\ge 2N^{1-\\epsilon}.$ By the second part of Lemma \\[lem:H2Formulas\\], for $c>0$ sufficiently small we have $$\\begin{aligned}\n    {\\mathcal{V}}(X_{f_n,r}) & =8\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}h_{2}\\left(T\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\right) \\gg r^{4}N^{-2}\\sum_{\\lambda\\ne\\lambda'\\in R}h_{2}\\left(T\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\right)\\\\\n    & \\gg r^{4}N^{-2}\\cdot \\#\\left\\{ \\lambda\\ne\\lambda'\\in R:\\,\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le c/T\\right\\} .\n    \\end{aligned}$$ By the first part of Lemma \\[lem:LowerBoundPairs\\], $${\\mathcal{V}}(X_{f_n,r})\\gg r^{4}N^{-2}\\left(\\#R\\right)^{2}T^{-1}\\gg r^{4}N^{-2\\epsilon}T^{-1}.$$\n\nThe lower bound of Theorem \\[thm:UpperBound3d\\] follows along the same lines as the above, this time using the second part of Lemma \\[lem:LowerBoundPairs\\] in place of the first one.\n\nNote that in the proof of of the lower bound in Theorem \\[thm:UpperBound2d\\] we have used the abundance of close-by pairs of lattice points with **$\\left|c_{\\lambda}\\right|^{2}\\ge \\frac{1}{2N}$**; in the absence of such close-by lattice points, the bound does not hold. For example, for $d=2$, fix $\\lambda_{0}\\in\\mathcal{E}_{n}$ and let $\\left|c_{\\pm\\lambda_{0}}\\right|^{2}=1/2$ and $c_{\\lambda}=0$ for every $\\lambda\\ne\\pm\\lambda_{0}.$ Then $${\\mathcal{V}}(X_{f_{n},r})=4\\pi^{2}r^{4}h_{2}\\left(2T\\right)\\ll r^{4}T^{-3}.$$\n\nFor the first part of Lemma \\[lem:LowerBoundPairs\\], divide $S^{1}$ into $k=O\\left(T\\right)$ arcs $I_{1},I_{2},\\dots,I_{k}$ of length $<1/T$. For every $1\\le j\\le k,$ let $n_{j}=\\#\\left\\{ m:\\,x_{m}\\in I_{j}\\right\\} ,$ so $\\sum_{j=1}^{k}n_{j}=M$. By the Cauchy-Schwarz inequality, $$M^{2}=\\left(\\sum_{j=1}^{k}n_{j}\\right)^{2}\\le k\\sum_{j=1}^{k}n_{j}^{2}\\ll T\\sum_{j=1}^{k}n_{j}^{2}.$$ Thus, $$\\begin{aligned}\n    \\#\\left\\{ x_{i}\\ne x_{j}:\\,\\left|x_{i}-x_{j}\\right|\\le1/T\\right\\}  & =\\#\\left\\{ x_{i},x_{j}:\\,\\left|x_{i}-x_{j}\\right|\\le1/T\\right\\} -M\\\\\n    & \\gg\\sum_{j=1}^{k}n_{j}^{2}-M\\gg M^{2}/T-M\\gg M^{2}/T.\n    \\end{aligned}$$ The second part of Lemma \\[lem:LowerBoundPairs\\] is proved similarly.\n\nRestricted averages {#sec:RestrictedAverages}\n===================\n\nRestricted moments\n------------------\n\nFor $ d=2 $, most of our principal results above are also valid in the more difficult scenario where $x$ is drawn in $B_{x_{0}}(\\rho)$ for some $x_{0}\\in{\\mathbb{T}}^{2}$ and $\\rho\\gg n^{-1/2+o(1)}$. In this case, the restricted moments are: expectation $$\\label{eq:restricted_expectation}\n{\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}] = \\frac{1}{{\\operatorname{Vol}}(B_{x_0}(\\rho))}\\int\\limits_{B_{x_{0}}(\\rho)}X_{f_{n},r;x}dx,$$ higher centred moments $$\\label{eq:centred moments rest}\n{\\mathbb{E}}_{x_{0},\\rho}[(X_{f_{n},r}-{\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}])^{k}] = \\frac{1}{{\\operatorname{Vol}}(B_{x_0}(\\rho))}\\int\\limits_{B_{x_{0}}(\\rho)}\\left(X_{f_{n},r;x}-{\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}]\\right)^{k}dx, \\hspace{1em}k\\ge2,$$ and in particular the variance $$\\label{eq:restricted_variance}\n{\\mathcal{V}}_{x_{0},\\rho}(X_{f_{n},r}) = {\\mathbb{E}}_{x_{0},\\rho}[(X_{f_{n},r}-{\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}])^{2}].$$\n\nWe reinterpret the statement of Granville-Wigman\u2019s \u00a0[@GranvilleWigman Theorem 1.2] as evaluating the expected mass $${\\mathbb{E}}_{x_{0},\\rho}[X_{f_{n},r}] \\sim \\pi r^{2},$$ valid for almost all $n\\in S_{2}$, uniformly for $\\rho\\gg n^{-1/2+o(1)}$, $x_{0}\\in{\\mathbb{T}}^{2}$, and $ r>0 $ (see the first part of Lemma \\[lem:ExpVarShrinking\\]).\n\nQuasi-correlations\n------------------\n\nFor the restricted moments of $X_{f_{n},r}$ one also needs to cope with [*quasi-correlations*]{}, i.e. tuples $(\\lambda^{1},\\ldots,\\lambda^{l}) \\in {\\mathcal{E}}_{n}^{l}$ with the sum $\\sum\\limits_{i=1}^{l}\\lambda^{i}$ unexpectedly small, e.g. given a (small) fixed number $\\delta >0$, $$\\label{eq:sum tuple small l,delta}\n\\left\\|\\sum\\limits_{i=1}^{l}\\lambda^{i}\\right\\| < n^{1/2-\\delta};$$ unlike the correlations , here there are no congruence obstructions, so that makes sense with $l$ odd or even.\n\n\\[def:separatedness Ac\\]\n\n1.  For $n\\in S_2$, $l\\in\\mathbb{Z}_{\\ge 2}$, and $0 < K=K(n) < l\\cdot n^{1/2}$ define the set of length-$l$ spectral quasi-correlations $$\\label{eq:quasi_correlations}\n    \\mathcal{C}_{n}(l;K) =\n    \\left\\{(\\lambda^{1},\\ldots,\\lambda^{l})\\in\\mathcal{E}_{n}^{l}:\\: 0 < \\left\\| \\sum\\limits_{j=1}^{l}\\lambda^{j} \\right\\| \\le K  \\right\\}.$$\n\n2.  Given $\\delta>0$ we say that $n \\in S_{2}$ satisfies the $(l,\\delta)$-separateness hypothesis $\\mathcal{A}(n;l,\\delta)$ if $$\\label{eq:sep_hypothesis}\n    \\mathcal{C}_{n}(l;n^{1/2-\\delta}) = \\varnothing.$$\n\nFor example, ${\\mathcal{A}}(n;2,\\delta)$ is equivalent to the aforementioned Bourgain-Rudnick separateness, satisfied \u00a0[@Bourgain-Rudnick Lemma 5] by a density $1$ sequence $S_{2}'\\subseteq S_{2}$. More generally, it was shown in the forthcoming paper \u00a0[@BenatarBuckleyWigman], that for every $\\delta>0$ and $l\\ge 2$, the assumption ${\\mathcal{A}}(n;l,\\delta)$ is satisfied by generic $n\\in S_{2}'(l,\\delta)$, and hence a standard diagonal argument yields a density $1$ sequence $S_{2}'\\subseteq S_{2}$ so that ${\\mathcal{A}}(n;l,\\delta)$ is satisfied for [*all*]{} $l\\ge 2$ and $ \\delta>0 $ for $ n\\in S_2' $ sufficiently large.\n\n\\[thm:quasi-corr small\\] For every fixed $l\\ge 2$ and $\\delta>0$ there exist a set $S_2'(l,\\delta)\\subseteq S_2$ such that:\n\n1.  The set $S_2'(l,\\delta)$ has density $1$ in $S_2$.\n\n2.  For every $n\\in S_2'(l,\\delta)$ the length-$l$ spectral quasi-correlation set $$\\mathcal{C}_{n}(l;n^{1/2-\\delta})=\\varnothing$$ is empty, i.e., the $(l,\\delta)$-separateness hypothesis $\\mathcal{A}(n;l,\\delta)$ is satisfied.\n\nA version of Theorem \\[thm:VarMainGeneralized\\] with restricted averages\n------------------------------------------------------------------------\n\nWe have the following analogue of Theorem \\[thm:VarMainGeneralized\\]:\n\n\\[thm:VarMainExplRestricted\\]\n\n1.  If $S_{2}'\\subseteq S_{2}$ is a sequence satisfying the hypotheses $ \\mathcal{D}(n,\\epsilon/2),$ $ {\\mathcal{A}}(n;2,\\epsilon)$, and ${\\mathcal{A}}(n;4,\\epsilon)$ for all $n\\in S_{2}'$, then in the setting of Theorem \\[thm:VarMainGeneralized\\] part (1), $${\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)\\sim\\frac{16}{3\\pi \\cos^{2}\\theta_{f_{n}}}r^{4}T^{-1}$$ uniformly for all $x_{0}\\in\\mathbb{T}^{2}$, $n^{-1/2+\\delta}\\le\\rho\\le 1$ and $r_{0}< r< r_{1}$, and $f_{n}\\in{\\mathcal{F}}_{1}(n;T(n),\\eta(n))$.\n\n2.  Let $k\\ge 3$ be an integer. If $S_{2}'\\subseteq S_{2}$ is a sequence satisfying the length-$2k$ diagonal domination assumption and the hypotheses $ \\mathcal{D}(n,\\epsilon),$ $ {\\mathcal{A}}(n;2,\\epsilon)$, $ {\\mathcal{A}}(n;4,\\epsilon)$, and ${\\mathcal{A}}(n;2k,\\epsilon)$ for all $n\\in S_{2}'$, then in the setting of Theorem \\[thm:VarMainGeneralized\\] part (2), $$\\mathbb{E}_{x_{0},\\rho}\\left[\\hat{X}_{f_{n},r}^{k}\\right] \\to {\\mathbb{E}}[Z^{k}]$$ uniformly for $x_{0}\\in{\\mathbb{T}}^{2}$, $r_{0} < r <r_{1}$, $n^{-1/2+\\delta} \\le \\rho \\le 1$, and $f_{n}\\in {\\mathcal{F}}_{2}(n;T(n),\\eta(n))$, where $Z\\sim N(0,1)$ is the standard Gaussian variable.\n\nTheorem \\[thm:VarMainExplRestricted\\] follows along similar lines as the proof of Theorem \\[thm:VarMainGeneralized\\], where we use the expressions for the restricted moments below (cf. equation , Lemma \\[lem:VarExpd2\\] and equation ). We remark that Theorem \\[thm:UpperBound2d\\] can also be extended to $ {\\mathcal{V}}_{x_{0},\\rho}(X_{f_{n},r}) $, however the lower bound will only hold for a generic $ n\\in S_2 $.\n\n\\[lem:ExpVarShrinking\\]\n\nFor $d=2$ let $0<\\delta<1/2$, $0<\\epsilon<\\delta/5$, and $S_{2}'\\subseteq S_{2}$.\n\n1.  If $n\\in S_{2}'$ satisfy the hypothesis ${\\mathcal{A}}(n;2,\\epsilon) $, then $$\\mathbb{E}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]=\\pi r^{2}+O\\left(r^{2}n^{-\\frac{3}{5}\\delta+3\\epsilon}\\right)$$ uniformly for $x_{0}\\in\\mathbb{T}^{2},$ $n^{-1/2+\\delta}\\le\\rho\\le1$ and $r>0$.\n\n2.  \\[lem:VarFormulaShrinking\\]\n\n    If $n\\in S_{2}'$ satisfy the hypotheses $ {\\mathcal{A}}(n;2,\\epsilon) $ and ${\\mathcal{A}}(n;4,\\epsilon)$, then $$\\begin{aligned}\n        \\text{\\ensuremath{\\mathcal{V}}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right) & =8\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n            \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n            \\lambda\\ne\\lambda'\n            \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}h_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right) +O\\left(r^{4} n^{-\\frac{3}{5}\\delta+4\\epsilon}\\right)\n        \\end{aligned}$$ uniformly for $x_{0}\\in\\mathbb{T}^{2},$ $n^{-1/2+\\delta}\\le\\rho\\le1$ and $r>0$.\n\n\\[lem:KthMoment\\]For $d=2$ let $ k\\ge3 $, $0<\\delta<1/2$, $0<\\epsilon< \\delta/5$, and $ S_2' \\subseteq S_2 $ satisfying $ {\\mathcal{A}}(2;n,\\epsilon), $ $ {\\mathcal{A}}(4;n,\\epsilon), $ and ${\\mathcal{A}}(n;2k,\\epsilon) $ for every $ n\\in S_2' $ . We have $$\\begin{aligned}\n    {\\mathbb{E}}_{x_{0},\\rho}[\\hat{X}_{f_{n},r}^{k}] & =(2\\pi)^k r^{2k}{\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)^{-k/2}\\sum_{\\begin{subarray}{c}\n        \\forall1\\le i\\le k,\\,\\lambda_{i}\\ne\\lambda_{i}'\\in\\mathcal{E}_{n}\\\\\n        \\sum_{i=1}^{k}\\left(\\lambda_{i}-\\lambda_{i}'\\right)=0\n        \\end{subarray}}\\prod_{j=1}^{k}c_{\\lambda_{j}}\\overline{c_{\\lambda_{j}'}}g_{2}\\left(r\\left\\Vert \\lambda_{j}-\\lambda_{j}'\\right\\Vert \\right)\\\\\n    & +O\\left({\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)^{-k/2}  r^{2k} n^{-\\frac{3}{5}\\delta+4\\epsilon}\\right)\\nonumber\n    \\end{aligned}$$ uniformly for $x_{0}\\in\\mathbb{T}^{2},$ $n^{-1/2+\\delta}\\le\\rho\\le1$ and $r>0$.\n\nProofs of Lemma \\[lem:ExpVarShrinking\\] and Lemma \\[lem:KthMoment\\]\n-------------------------------------------------------------------\n\nWe have $$\\label{eq:exp_basic_formula}\n    {\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]=\\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y\\,\\text{d}x.$$\n\nGranville-Wigman\u2019s [@GranvilleWigman Theorem 1.2] asserts that for $ \\epsilon_1 > \\epsilon_2 > 0$, $ 0 < \\epsilon_3 < \\epsilon_1 - \\epsilon_2 $ and $ n\\in S_2 $ satisfying ${\\mathcal{A}}(n;2,\\epsilon_2) $, we have $$\\label{eq:Granville_Wigman_theorem}\n    \\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y = \\pi r^2 \\left(1+ O\\left(n^{-3\\epsilon_3 /2}\\right)\\right)$$ uniformly in $ x\\in \\mathbb{T}^2 $ and $ r>n^{-1/2 + \\epsilon_1} $. If $r>n^{-1/2+\\frac{2}{5}\\delta}$, then by substituting with $ \\epsilon_1 = \\frac{2}{5}\\delta $, $ \\epsilon_2 = \\epsilon $ and $ \\epsilon_3 = \\frac{2}{5}\\delta - 2\\epsilon $ into , we have $${\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]=\\pi r^{2}\\left(1+O\\left(n^{-\\frac{3}{2}\\left( \\frac{2}{5}\\delta - 2\\epsilon\\right)}\\right)\\right)$$ for every $\\rho$.\n\nOtherwise, note that $${\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]=\\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho+r\\right)}f_{n}\\left(y\\right)^{2}\\int_{B_{x_{0}}\\left(\\rho\\right)\\cap B_{y}\\left(r\\right)}\\,\\text{d}x\\,\\text{d}y,$$ so $$\\label{eq:Exp_upper_lower_bnds}\n    \\frac{r^{2}}{\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho-r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y\\le{\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]\\le\\frac{r^{2}}{\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho+r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y.$$ Since $r/\\rho \\le n^{-\\frac{3}{5}\\delta}$, we can use with $ \\epsilon_1 = \\delta $, $ \\epsilon_2 = \\epsilon $ and $ \\epsilon_3 = \\delta - 2\\epsilon $ to deduce that $$\\label{eq:Exp_Inner_integral}\n    \\int_{B_{x_{0}}\\left(\\rho\\pm r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y=\\pi\\rho^{2}\\left(1+O\\left(n^{-\\frac{3}{5}\\delta}\\right)\\right),$$ and the statement of the first part of Lemma \\[lem:ExpVarShrinking\\] follows upon substituting into .\n\nWe have $${\\mathcal{V}}_{x_{0},\\rho}(X_{f_{n},r}) = \\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-   {\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]\\right)^{2}\\,\\text{d}x.$$\n\nBy (\\[eq:IntegrandVar\\]), $$\\begin{aligned}\n    & \\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\pi r^{2}\\right)^{2}\\,\\text{d}x\\\\\n    & =4\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda',\\lambda'',\\lambda'''\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\\\\\n        \\lambda''\\ne\\lambda'''\n        \\end{subarray}}c_{\\lambda}\\overline{c_{\\lambda'}}c_{\\lambda''}\\overline{c_{\\lambda'''}}g_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)g_{2}\\left(r\\left\\Vert \\lambda''-\\lambda'''\\right\\Vert \\right)\\\\\n    & \\times\\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}e\\left(\\left\\langle x,\\lambda-\\lambda'+\\lambda''-\\lambda'''\\right\\rangle \\right)\\,\\text{d}x\\\\\n    & =8\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\n        \\end{subarray}}\\left|c_{\\lambda}\\right|^{2}\\left|c_{\\lambda'}\\right|^{2}g_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)^{2}\\\\\n    & +8\\pi^{2}r^{4}\\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda',\\lambda'',\\lambda'''\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\\\\\n        \\lambda''\\ne\\lambda'''\\\\\n        \\lambda-\\lambda'+\\lambda''-\\lambda'''\\ne0\n        \\end{subarray}}c_{\\lambda}\\overline{c_{\\lambda'}}c_{\\lambda''}\\overline{c_{\\lambda'''}}g_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)g_{2}\\left(r\\left\\Vert \\lambda''-\\lambda'''\\right\\Vert \\right)\\\\\n    & \\times e\\left(\\left\\langle x_{0},\\lambda-\\lambda'+\\lambda''-\\lambda'''\\right\\rangle \\right)g_{2}\\left(\\rho\\left\\Vert \\lambda-\\lambda'+\\lambda''-\\lambda'''\\right\\Vert \\right).\n    \\end{aligned}$$ By the hypothesis ${\\mathcal{A}}(n;4,\\epsilon)$ and Lemma \\[lem:H2Formulas\\], we have $$\\begin{aligned}\n    & \\sum_{\\begin{subarray}{c}\n        \\lambda,\\lambda',\\lambda'',\\lambda'''\\in\\mathcal{E}_{n}\\\\\n        \\lambda\\ne\\lambda'\\\\\n        \\lambda''\\ne\\lambda'''\\\\\n        \\lambda-\\lambda'+\\lambda''-\\lambda'''\\ne0\n        \\end{subarray}}c_{\\lambda}\\overline{c_{\\lambda'}}c_{\\lambda''}\\overline{c_{\\lambda'''}}g_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)g_{2}\\left(r\\left\\Vert \\lambda''-\\lambda'''\\right\\Vert \\right)\\\\\n    & \\times e\\left(\\left\\langle x_{0},\\lambda-\\lambda'+\\lambda''-\\lambda'''\\right\\rangle \\right)g_{2}\\left(\\rho\\left\\Vert \\lambda-\\lambda'+\\lambda''-\\lambda'''\\right\\Vert \\right)\\\\\n    & \\ll\\left(\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|\\right)^{4}\\frac{1}{\\left(n^{\\delta-\\epsilon}\\right)^{3/2}}\\ll N^{2}n^{-\\frac{3}{2}(\\delta-\\epsilon)} \\ll n^{-\\frac{3}{2}\\delta + 2\\epsilon}.\n    \\end{aligned}$$\n\nNext, note that $$\\begin{aligned}\n    \\label{eq:inner_int_estimate}\n    \\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\pi r^{2} &=  2\\pi r^{2}\\sum_{\\lambda\\ne\\lambda'\\in\\mathcal{E}_{n}}\n    c_{\\lambda}\\overline{c_{\\lambda'}}g_{2}\\left(r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)   \\ll r^2 \\left(\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|\\right)^{2} \\ll N r^2.\n    \\end{aligned}$$ By and the first part of Lemma \\[lem:ExpVarShrinking\\],\n\n$${\\mathcal{V}}_{x_{0},\\rho}(X_{f_{n},r}) = \\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\pi r^{2}\\right)^{2}\\,\\text{d}x + O\\left(r^4 n^{-\\frac{3}{5}\\delta+4\\epsilon}\\right)$$\n\nand the statement of Lemma \\[lem:VarExpd2\\] follows.\n\nWe have $${\\mathbb{E}}_{x_{0},\\rho}[\\hat{X}_{f_{n},r}^{k}]  = {\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)^{-k/2} \\cdot \\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-   {\\mathbb{E}}_{x_{0},\\rho}\\left[X_{f_{n},r}\\right]\\right)^{k}\\,\\text{d}x.$$ By (\\[eq:IntegrandVar\\]), we have $$\\begin{aligned}\n    \\frac{1}{\\pi\\rho^{2}}&\\int_{B_{x_{0}}\\left(\\rho\\right)} \\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\pi r^{2}\\right)^{k}\\,\\text{d}x = \\left(2\\pi\\right)^{k}r^{2k} \\sum_{\\begin{subarray}{c}\n        \\forall1\\le i\\le k,\\,\\lambda_{i}\\ne\\lambda_{i}'\\in\\mathcal{E}_{n}\\\\\n        \\sum_{i=1}^{k}\\left(\\lambda_{i}-\\lambda_{i}'\\right)=0\n        \\end{subarray}}\\prod_{j=1}^{k}c_{\\lambda_{j}}\\overline{c_{\\lambda_{j}'}}g_{2}\\left(r\\left\\Vert \\lambda_{j}-\\lambda_{j}'\\right\\Vert \\right)\\\\\n    & +\\left(2\\pi\\right)^{k}r^{2k}\\sum_{\\begin{subarray}{c}\n        \\forall1\\le i\\le k,\\,\\lambda_{i}\\ne\\lambda_{i}'\\in\\mathcal{E}_{n}\\\\\n        \\sum_{i=1}^{k}\\left(\\lambda_{i}-\\lambda_{i}'\\right)\\ne0\n        \\end{subarray}}\\prod_{j=1}^{k}c_{\\lambda_{j}}\\overline{c_{\\lambda_{j}'}}g_{2}\\left(r\\left\\Vert \\lambda_{j}-\\lambda_{j}'\\right\\Vert \\right)\\\\\n    & \\times2e\\left(\\left\\langle x_{0},\\sum_{j=1}^{k}\\left(\\lambda_{j}-\\lambda_{j}'\\right)\\right\\rangle \\right)g_{2}\\left(\\rho\\left\\Vert \\sum_{j=1}^{k}\\left(\\lambda_{j}-\\lambda_{j}'\\right)\\right\\Vert \\right).\n    \\end{aligned}$$ By the hypothesis ${\\mathcal{A}}(n;2k,\\epsilon)$, $$\\begin{aligned}\n    \\sum_{\\begin{subarray}{c}\n        \\forall1\\le i\\le k,\\,\\lambda_{i}\\ne\\lambda_{i}'\\in\\mathcal{E}_{n}\\\\\n        \\sum_{i=1}^{k}\\left(\\lambda_{i}-\\lambda_{i}'\\right)\\neq0\n        \\end{subarray}}& \\prod_{j=1}^{k}c_{\\lambda_{j}}\\overline{c_{\\lambda_{j}'}}g_{2}\\left(r\\left\\Vert \\lambda_{j}-\\lambda_{j}'\\right\\Vert \\right) e\\left(\\left\\langle x_{0},\\sum_{j=1}^{k}\\left(\\lambda_{j}-\\lambda_{j}'\\right)\\right\\rangle \\right)g_{2}\\left(\\rho\\left\\Vert \\sum_{j=1}^{k}\\left(\\lambda_{j}-\\lambda_{j}'\\right)\\right\\Vert \\right)\\\\\n    & \\ll\\left(\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|\\right)^{2k}\\frac{1}{\\left(n^{\\delta - \\epsilon}\\right)^{3/2}}\\ll N^k n^{-\\frac{3}{2}(\\delta-\\epsilon)} \\ll n^{-\\frac{3}{2}+2\\epsilon}.\n    \\end{aligned}$$ By and the first part of Lemma \\[lem:ExpVarShrinking\\], $$\\begin{aligned}\n    \\mathbb{E}_{x_{0},\\rho}[\\hat{X}_{f_{n},r}^{k}] & = {\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)^{-k/2} \\cdot \\frac{1}{\\pi\\rho^{2}}\\int_{B_{x_{0}}\\left(\\rho\\right)}\\left(\\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y-\\pi r^2 \\right)^{k}\\,\\text{d}x \\\\ &+  O\\left({\\mathcal{V}}_{x_{0},\\rho}\\left(X_{f_{n},r}\\right)^{-k/2} r^{2k}  n^{-\\frac{3}{5}\\delta+4\\epsilon}\\right),\n    \\end{aligned}$$ and the statement of Lemma \\[lem:KthMoment\\] follows.\n\n\\[sec:AuxLemmasProof\\]Proofs of auxiliary lemmas\n================================================\n\nIn this section we provide the proofs for lemmas \\[lem:BasicVarProp\\], \\[lem:InnerIntegral\\], and \\[lem:CosToDist\\]:\n\n\u00a0\n\n1.  The upper bound is straightforward, and the lower bound follows from (\\[eq:BasicNormalization\\]) by invoking the Cauchy-Schwarz inequality on .\n\n2.  By partial summation, for every $\\lambda_{0}\\in\\mathcal{E}_{n}$ we have $$1=\\sum_{\\lambda\\in\\mathcal{E}_{n}}\\left|c_{\\lambda}\\right|^{2}=N\\left|c_{\\lambda_{0}}\\right|^{2}+E,$$ where $\\left|E\\right|\\le V\\left(\\underline{v} \\right)$. Since $\\lambda_{0}$ is arbitrary, we deduce that $$[\\underline{v}]_{\\infty} \\le1+V\\left(\\underline{v} \\right).$$\n\n3.  Follows directly from parts $1$ and $2$ of this lemma.\n\nWe have $$\\begin{aligned}\n        \\label{eq:inner_int_expansion}\n        \\int_{B_{x}\\left(r\\right)}f_{n}\\left(y\\right)^{2}\\,\\text{d}y&=\\int_{B_{x}\\left(r\\right)}\\sum_{\\lambda,\\lambda'\\in\\mathcal{E}_{n}}c_{\\lambda}\\overline{c_{\\lambda'}}e\\left(\\left\\langle y,\\lambda-\\lambda'\\right\\rangle \\right)\\,\\text{d}y\\\\\n        & =\\frac{\\pi^{d/2}}{\\Gamma\\left(d/2+1\\right)}r^{d}+\\sum_{\\begin{subarray}{c}\n                \\lambda,\\lambda'\\in\\mathcal{E}_{n}\\\\\n                \\lambda\\ne\\lambda'\n        \\end{subarray}}c_{\\lambda}\\overline{c_{\\lambda'}}\\int_{B_{x}\\left(r\\right)}e\\left(\\left\\langle y,\\lambda-\\lambda'\\right\\rangle \\right)\\,\\text{d}y.\\nonumber\n    \\end{aligned}$$ Transforming the variables $y=rz+x$, we obtain $$\\label{eq:var_transformation}\n        \\int_{B_{x}\\left(r\\right)}e\\left(\\left\\langle y,\\lambda-\\lambda'\\right\\rangle \\right)\\,\\text{d}y=r^{d}e\\left(\\left\\langle x,\\lambda-\\lambda'\\right\\rangle \\right)\\int_{B_{0}\\left(1\\right)}e\\left(\\left\\langle z,r\\left(\\lambda-\\lambda'\\right)\\right\\rangle \\right)\\,\\text{d}z.$$ Note that $$\\begin{aligned}\n        \\label{eq:Fourier_ball}\n        \\int_{B_{0}\\left(1\\right)}e\\left(\\left\\langle z,r\\left(\\lambda-\\lambda'\\right)\\right\\rangle \\right)\\,\\text{d}z & =\\frac{\\left(2\\pi\\right)^{d/2}J_{d/2}\\left(2 \\pi r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)}{\\left(2 \\pi r\\left\\Vert \\lambda-\\lambda'\\right\\Vert \\right)^{d/2}},\n    \\end{aligned}$$ and (\\[eq:IntegrandVar\\]) follows upon substituting into and finally into .\n\nLet $\\theta_{\\lambda}$ be the angle between $\\lambda$ and $\\lambda'$. Then $$\\begin{aligned}\n    \\frac{1}{N} \\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\lambda\\succeq\\lambda',\\left\\Vert \\widehat{\\lambda}-\\widehat{\\lambda'}\\right\\Vert \\le s\\right\\}\n    & =\\frac{1}{N}\\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\theta_{\\lambda}\\ge0,\\,\\sqrt{2\\left(1-\\cos\\theta_{\\lambda}\\right)}\\le s\\right\\} \\\\\n    & =\\frac{1}{N}\\cdot \\#\\left\\{ \\lambda\\in\\mathcal{E}_{n}:\\,\\theta_{\\lambda}\\in\\left[0,\\arccos\\left(1-s^{2}/2\\right)\\right]\\right\\} \\\\\n    & =\\frac{1}{2\\pi}\\arccos\\left(1-s^{2}/2\\right)+O\\left(\\Delta\\left(n\\right)\\right)\\\\\n    & =\\frac{s}{2\\pi}+O\\left(s^{3}+\\Delta\\left(n\\right)\\right)\n    \\end{aligned}$$ which is the statement (\\[eq:CosToDistEq\\]) of Lemma \\[lem:CosToDist\\].\n\n[10]{}\n\nBenatar, J., Buckley, J., Wigman, I., *Two applications of Bourgain\u2019s de-randomization method on toral eigenfunctions and spectral quasi-correlations*, in preparation.\n\nBenatar, J., Marinucci, D., Wigman, I. *Planck-scale distribution of nodal length of arithmetic random waves*.\n\nBenatar, J., Maffucci R. W., *Random waves on $\\mathbb{T}^{3}$: nodal area variance and lattice point correlations.* Int. Math. Res. Not., to appear.\n\nBerry, Michael. [*Regular and irregular semiclassical wavefunctions.*]{} J. Phys. A 10 (1977), no. 12, 2083\u20132091.\n\nBerry, Michael. [*Semiclassical mechanics of regular and irregular motion.*]{} Chaotic behavior of deterministic systems (Les Houches, 1981), 171\u2013271, North-Holland, Amsterdam, 1983.\n\nBombieri, E., Bourgain, J., *A problem on sums of two squares*. Int. Math. Res. Not. IMRN (2015), no. 11, 33433407.\n\nBourgain, J. *On toral eigenfunctions and the random wave model*. Israel J. Math. **201** (2014), no. 2, 611630.\n\nBourgain J., Rudnick Z., Sarnak P., *Spatial statistics for lattice points on the sphere I: Individual results*. The Bulletin of the Iranian Mathematical Society (BIMS), special issue in honor of Freydoon Shahidi\u2019s 70\u2019th birthday, to appear.\n\nBourgain, Jean; Rudnick, Ze\u00e9v. [*On the geometry of the nodal lines of eigenfunctions of the two-dimensional torus.*]{} Ann. Henri Poincar\u00e9 12 (2011), no. 6, 1027\u20131053.\n\nY. Colin de Verdi\u00e8re, *Ergodicit\u00e9 et fonctions propres du Laplacien*, Comm. Math. Phys. [**102**]{} (1985), 497-502.\n\nde Courcy-Ireland, Matthew. [*Small-scale equidistribution for random spherical harmonics.*]{} Preprint. available online, <https://arxiv.org/abs/1711.01317>\n\nErd\u0151s, P., Hall, R. R., *On the angular distribution of Gaussian integers with fixed norm*. Discrete Math. **200** (1999), no. 1-3, 8794.\n\nFeller W., *An introduction to probability theory and its applications, Vol. 2.* Second edition. Wiley, New York (1971).\n\nGradhsteyn I. S., Rizhik I.M., *Table of integrals, series and products,* 6th Edition, Academic Press (2000).\n\nGranville, A., Wigman, I., *Planck-scale mass equidistribution of toral Laplace eigenfunctions,* Communications in Mathematical Physics, 355(2), 2017, pp.767-802.\n\nHan, Xiaolong. [*Small scale quantum ergodicity in negatively curved manifolds.*]{} Nonlinearity 28 (2015), no. 9, 3263\u20133288.\n\nHan, Xiaolong. [*Small Scale Equidistribution of Random Eigenbases.*]{} Comm. Math. Phys., to appear, available online <https://arxiv.org/abs/1511.01195>\n\nHan, Xiaolong, Tacy, Melissa. [*Equidistribution of random waves on small balls.*]{} Preprint. available online, <https://arxiv.org/abs/1611.05983>\n\nHezari, Hamid; Rivi\u00e8re, Gabriel. [*$L^{p}$ norms, nodal sets, and quantum ergodicity.*]{} Adv. Math. 290 (2016), 938\u2013966.\n\nHezari, Hamid; Rivi\u00e8re, Gabriel. [Quantitative equidistribution properties of toral eigenfunctions.]{} J. Spec. Thr., to appear, available online <https://arxiv.org/abs/1503.02794>\n\nHumphries, P., 2017. Equidistribution in Shrinking Sets and $L^4$-Norm Bounds for Automorphic Forms. arXiv preprint arXiv:1705.05488.\n\nKuipers L., Niederreiter H., *Uniform distribution of sequences.* Wiley, New York (1974).\n\nKrishnapur, M., Kurlberg, P., Wigman, I. *Nodal length fluctuations for arithmetic random waves*, Annals of Mathematics (2) 177, no. 2, 699\u2013737 (2013).\n\nLester, Stephen; Rudnick, Ze\u00e9v. [*Small scale equidistribution of eigenfunctions on the torus.*]{} Comm. Math. Phys. 350 (2017), no. 1, 279\u2013-300.\n\nLuo, Wen Zhi; Sarnak, Peter. [*Quantum ergodicity of eigenfunctions on $PSL_{2}({\\mathbb{Z}})\\setminus \\mathbb{H}^{2}$.*]{} Inst. Hautes \u00c9tudes Sci. Publ. Math. No. 81 (1995), 207\u2013237.\n\nSarnak, P. [*Variance sums on symmetric spaces.*]{} Private communication.\n\nSartori, A. [*Mass distribution for toral eigenfunctions via Bourgain\u2019s de-randomisation.*]{} available online <https://arxiv.org/abs/1812.00962>\n\nA. Snirel\u2019man, *Ergodic properties of eigenfunctions*, Uspekhi Mat. Nauk [**180**]{} (1974), 181-182.\n\nYoung, M. *The quantum unique ergodicity conjecture for thin sets*. Adv. Math. **286** (2016), 958-1016.\n\nS. Zelditch, *Uniform distribution of eigenfunctions on compact hyperbolic surfaces*, Duke Math. J. [**55**]{} (1987), 919-941.\n\nZygmund, A. *On Fourier coefficients and transforms of functions of two variables*. Studia Math. 50 (1974), 189201.\n"
}