{
    "criteria": [
        {
            "criterion": "AllDocuments",
            "passed": true,
            "reason": "All documents pass."
        },
        {
            "criterion": "Domain",
            "passed": false,
            "reason": "Document source unavailable."
        },
        {
            "criterion": "QuestionAnswerStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "QuestionAnswerStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "FullyStructured",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ListPrefix",
            "passed": true,
            "reason": "Found 5 list prefixes. (Min: 5)"
        },
        {
            "criterion": "ListPrefixV2",
            "passed": false,
            "reason": "Does not meet criterion."
        }
    ],
    "doc_id": "2261",
    "text": "/*\n * xfrm6_mode_ro.c - Route optimization mode for IPv6.\n *\n * Copyright (C)2003-2006 Helsinki University of Technology\n * Copyright (C)2003-2006 USAGI/WIDE Project\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n */\n/*\n * Authors:\n *\tNoriaki TAKAMIYA @USAGI\n *\tMasahide NAKAMURA @USAGI\n */\n\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/skbuff.h>\n#include <linux/spinlock.h>\n#include <linux/stringify.h>\n#include <linux/time.h>\n#include <net/ipv6.h>\n#include <net/xfrm.h>\n\n/* Add route optimization header space.\n *\n * The IP header and mutable extension headers will be moved forward to make\n * space for the route optimization header.\n */\nstatic int xfrm6_ro_output(struct xfrm_state *x, struct sk_buff *skb)\n{\n\tstruct ipv6hdr *iph;\n\tu8 *prevhdr;\n\tint hdr_len;\n\n\tiph = ipv6_hdr(skb);\n\n\thdr_len = x->type->hdr_offset(x, skb, &prevhdr);\n\tskb_set_mac_header(skb, (prevhdr - x->props.header_len) - skb->data);\n\tskb_set_network_header(skb, -x->props.header_len);\n\tskb->transport_header = skb->network_header + hdr_len;\n\t__skb_pull(skb, hdr_len);\n\tmemmove(ipv6_hdr(skb), iph, hdr_len);\n\n\tx->lastused = get_seconds();\n\n\treturn 0;\n}\n\nstatic struct xfrm_mode xfrm6_ro_mode = {\n\t.output = xfrm6_ro_output,\n\t.owner = THIS_MODULE,\n\t.encap = XFRM_MODE_ROUTEOPTIMIZATION,\n};\n\nstatic int __init xfrm6_ro_init(void)\n{\n\treturn xfrm_register_mode(&xfrm6_ro_mode, AF_INET6);\n}\n\nstatic void __exit xfrm6_ro_exit(void)\n{\n\tint err;\n\n\terr = xfrm_unregister_mode(&xfrm6_ro_mode, AF_INET6);\n\tBUG_ON(err);\n}\n\nmodule_init(xfrm6_ro_init);\nmodule_exit(xfrm6_ro_exit);\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS_XFRM_MODE(AF_INET6, XFRM_MODE_ROUTEOPTIMIZATION);\n"
}