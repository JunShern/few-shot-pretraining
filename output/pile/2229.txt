{
    "criteria": [
        {
            "criterion": "AllDocuments",
            "passed": true,
            "reason": "All documents pass."
        },
        {
            "criterion": "QuestionAnswerStringsV2",
            "passed": true,
            "reason": "Text contains ['Q:', 'A:']."
        },
        {
            "criterion": "FullyStructured",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ListPrefixV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesMinimalEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesSynonymsEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesDiverseEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        }
    ],
    "doc_id": "2229",
    "text": "Q:\n\nBigQuery - Group by on arrays\n\nI want to group by on an array.\nsample query: \n#standardSQL\nWITH `project.dataset.table` AS (\n  SELECT 'compute' description, '[{\"key\":\"application\",\"value\":\"scaled-server\"},{\"key\":\"department\",\"value\":\"hrd\"}]' labels, 0.323316 cost UNION ALL\n  SELECT 'compute' description, '[{\"key\":\"application\",\"value\":\"scaled-server\"},{\"key\":\"department\",\"value\":\"hrd\"}]' labels, 0.342825 cost \n)\nSELECT \n  description, \n  ARRAY(\n    SELECT AS STRUCT \n      JSON_EXTRACT_SCALAR(kv, '$.key') key, \n      JSON_EXTRACT_SCALAR(kv, '$.value') value \n    FROM UNNEST(SPLIT(labels, '},{')) kv_temp, \n    UNNEST([CONCAT('{', REGEXP_REPLACE(kv_temp, r'^\\[{|}]$', ''), '}')]) kv\n  ) labels,\n  cost\nFROM `project.dataset.table`\n\nResult of the above query:\nRow description labels.key      labels.value    cost     \n1   compute         application     scaled-server   0.323316     \n                    department      hrd      \n2   compute         application    scaled-server  0.342825     \n                    department     hrd\n\nI want result like below:\nRow description labels.key      labels.value    cost     \n1   compute         application     scaled-server   0.666141     \n                    department      hrd   \n\nA:\n\n#standardSQL\nWITH `project.dataset.table` AS (\n  SELECT 'compute' description, '[{\"key\":\"application\",\"value\":\"scaled-server\"},{\"key\":\"department\",\"value\":\"hrd\"}]' labels, 0.323316 cost UNION ALL\n  SELECT 'compute' description, '[{\"key\":\"application\",\"value\":\"scaled-server\"},{\"key\":\"department\",\"value\":\"hrd\"}]' labels, 0.342825 cost \n), temp AS (\n  SELECT description, labels, SUM(cost) AS cost\n  FROM `project.dataset.table`\n  GROUP BY description, labels\n)\nSELECT \n  description, \n  ARRAY(\n    SELECT AS STRUCT \n      JSON_EXTRACT_SCALAR(kv, '$.key') key, \n      JSON_EXTRACT_SCALAR(kv, '$.value') value \n    FROM UNNEST(SPLIT(labels, '},{')) kv_temp, \n    UNNEST([CONCAT('{', REGEXP_REPLACE(kv_temp, r'^\\[{|}]$', ''), '}')]) kv\n  ) labels,\n  cost\nFROM temp\n\n"
}