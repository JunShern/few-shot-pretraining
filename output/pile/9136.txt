{
    "criteria": [
        {
            "criterion": "AllDocuments",
            "passed": true,
            "reason": "All documents pass."
        },
        {
            "criterion": "QuestionAnswerStringsV2",
            "passed": true,
            "reason": "Text contains ['Q:', 'A:', 'A:', 'A:']."
        },
        {
            "criterion": "FullyStructured",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ListPrefixV2",
            "passed": true,
            "reason": "Text contains ['-', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0']."
        },
        {
            "criterion": "ExamplesMinimalEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesSynonymsEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesDiverseEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        }
    ],
    "doc_id": "9136",
    "text": "Q:\n\nHow do I make Linux recognize a new SATA /dev/sda drive I hot swapped in without rebooting?\n\nHot swapping out a failed SATA /dev/sda drive worked fine, but when I went to swap in a new drive, it wasn't recognized:\n[root@fs-2 ~]# tail -18 /var/log/messages\nMay 5 16:54:35 fs-2 kernel: ata1: exception Emask 0x10 SAct 0x0 SErr 0x50000 action 0xe frozen\nMay 5 16:54:35 fs-2 kernel: ata1: SError: { PHYRdyChg CommWake }\nMay 5 16:54:40 fs-2 kernel: ata1: link is slow to respond, please be patient (ready=0)\nMay 5 16:54:45 fs-2 kernel: ata1: device not ready (errno=-16), forcing hardreset\nMay 5 16:54:45 fs-2 kernel: ata1: soft resetting link\nMay 5 16:54:50 fs-2 kernel: ata1: link is slow to respond, please be patient (ready=0)\nMay 5 16:54:55 fs-2 kernel: ata1: SRST failed (errno=-16)\nMay 5 16:54:55 fs-2 kernel: ata1: soft resetting link\nMay 5 16:55:00 fs-2 kernel: ata1: link is slow to respond, please be patient (ready=0)\nMay 5 16:55:05 fs-2 kernel: ata1: SRST failed (errno=-16)\nMay 5 16:55:05 fs-2 kernel: ata1: soft resetting link\nMay 5 16:55:10 fs-2 kernel: ata1: link is slow to respond, please be patient (ready=0)\nMay 5 16:55:40 fs-2 kernel: ata1: SRST failed (errno=-16)\nMay 5 16:55:40 fs-2 kernel: ata1: limiting SATA link speed to 1.5 Gbps\nMay 5 16:55:40 fs-2 kernel: ata1: soft resetting link\nMay 5 16:55:45 fs-2 kernel: ata1: SRST failed (errno=-16)\nMay 5 16:55:45 fs-2 kernel: ata1: reset failed, giving up\nMay 5 16:55:45 fs-2 kernel: ata1: EH complete\n\nI tried a couple things to make the server find the new /dev/sda, such as rescan-scsi-bus.sh but they didn't work:\n[root@fs-2 ~]# echo \"---\" > /sys/class/scsi_host/host0/scan\n-bash: echo: write error: Invalid argument\n[root@fs-2 ~]#\n[root@fs-2 ~]# /root/rescan-scsi-bus.sh -l\n[snip]\n0 new device(s) found.\n0 device(s) removed.\n[root@fs-2 ~]#\n[root@fs-2 ~]# ls /dev/sda\nls: /dev/sda: No such file or directory\n\nI ended up rebooting the server.  /dev/sda was recognized, I fixed the software RAID, and everything is fine now.  But for next time, how can I make Linux recognize a new SATA drive I have hot swapped in without rebooting?\nThe operating system in question is RHEL5.3:\n[root@fs-2 ~]# cat /etc/redhat-release\nRed Hat Enterprise Linux Server release 5.3 (Tikanga)\n\nThe hard drive is a Seagate Barracuda ES.2 SATA 3.0-Gb/s 500-GB, model ST3500320NS.\nHere is the lscpi output:\n[root@fs-2 ~]# lspci\n00:00.0 RAM memory: nVidia Corporation MCP55 Memory Controller (rev a2)\n00:01.0 ISA bridge: nVidia Corporation MCP55 LPC Bridge (rev a3)\n00:01.1 SMBus: nVidia Corporation MCP55 SMBus (rev a3)\n00:02.0 USB Controller: nVidia Corporation MCP55 USB Controller (rev a1)\n00:02.1 USB Controller: nVidia Corporation MCP55 USB Controller (rev a2)\n00:04.0 IDE interface: nVidia Corporation MCP55 IDE (rev a1)\n00:05.0 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:05.1 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:05.2 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:06.0 PCI bridge: nVidia Corporation MCP55 PCI bridge (rev a2)\n00:08.0 Bridge: nVidia Corporation MCP55 Ethernet (rev a3)\n00:09.0 Bridge: nVidia Corporation MCP55 Ethernet (rev a3)\n00:0a.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0b.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0c.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0d.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0e.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0f.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:18.0 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] HyperTransport Technology Configuration\n00:18.1 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Address Map\n00:18.2 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] DRAM Controller\n00:18.3 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Miscellaneous Control\n00:19.0 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] HyperTransport Technology Configuration\n00:19.1 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Address Map\n00:19.2 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] DRAM Controller\n00:19.3 Host bridge: Advanced Micro Devices [AMD] K8 [Athlon64/Opteron] Miscellaneous Control\n03:00.0 VGA compatible controller: Matrox Graphics, Inc. MGA G200e [Pilot] ServerEngines (SEP1) (rev 02)\n04:00.0 PCI bridge: NEC Corporation uPD720400 PCI Express - PCI/PCI-X Bridge (rev 06)\n04:00.1 PCI bridge: NEC Corporation uPD720400 PCI Express - PCI/PCI-X Bridge (rev 06)\n\nUpdate: In perhaps a dozen cases, we've been forced to reboot servers because hot swap hasn't \"just worked.\"  Thanks for the answers to look more into the SATA controller.  I've included the lspci output for the problematic system above (hostname: fs-2).  I could still use some help understanding what exactly isn't supported hardware-wise in terms of hot swap for that system.  Please let me know what other output besides lspci might be useful.\nThe good news is that hot swap \"just worked\" today on one of our servers (hostname: www-1), which is very rare for us.  Here is the lspci output:\n[root@www-1 ~]# lspci\n00:00.0 RAM memory: nVidia Corporation MCP55 Memory Controller (rev a2)\n00:01.0 ISA bridge: nVidia Corporation MCP55 LPC Bridge (rev a3)\n00:01.1 SMBus: nVidia Corporation MCP55 SMBus (rev a3)\n00:02.0 USB Controller: nVidia Corporation MCP55 USB Controller (rev a1)\n00:02.1 USB Controller: nVidia Corporation MCP55 USB Controller (rev a2)\n00:04.0 IDE interface: nVidia Corporation MCP55 IDE (rev a1)\n00:05.0 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:05.1 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:05.2 IDE interface: nVidia Corporation MCP55 SATA Controller (rev a3)\n00:06.0 PCI bridge: nVidia Corporation MCP55 PCI bridge (rev a2)\n00:08.0 Bridge: nVidia Corporation MCP55 Ethernet (rev a3)\n00:09.0 Bridge: nVidia Corporation MCP55 Ethernet (rev a3)\n00:0b.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0c.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:0f.0 PCI bridge: nVidia Corporation MCP55 PCI Express bridge (rev a3)\n00:18.0 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] HyperTransport Configuration\n00:18.1 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Address Map\n00:18.2 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] DRAM Controller\n00:18.3 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Miscellaneous Control\n00:18.4 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Link Control\n00:19.0 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] HyperTransport Configuration\n00:19.1 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Address Map\n00:19.2 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] DRAM Controller\n00:19.3 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Miscellaneous Control\n00:19.4 Host bridge: Advanced Micro Devices [AMD] K10 [Opteron, Athlon64, Sempron] Link Control\n03:00.0 VGA compatible controller: Matrox Graphics, Inc. MGA G200e [Pilot] ServerEngines (SEP1) (rev 02)\n04:00.0 PCI bridge: NEC Corporation uPD720400 PCI Express - PCI/PCI-X Bridge (rev 06)\n04:00.1 PCI bridge: NEC Corporation uPD720400 PCI Express - PCI/PCI-X Bridge (rev 06)\n09:00.0 SCSI storage controller: LSI Logic / Symbios Logic SAS1064ET PCI-Express Fusion-MPT SAS (rev 04)\n\nA:\n\nIf your SATA controller supports hot swap, it should \"just work(tm).\"\nTo force a rescan on a SCSI BUS (each SATA port shows as a SCSI BUS) and find new drives, you will use:\necho \"0 0 0\" >/sys/class/scsi_host/host<n>/scan\n\nOn the above, < n > is the BUS number.\n\nA:\n\necho \"- - -\" >/sys/class/scsi_host/host<n>/scan\n       ^ ^\n        \\_\\_______ note spaces between the dashes.\n\nA:\n\nWhen a drive has failed in some circumstances Linux won't realise you've actually pulled it physically from the array.  If you have that problem (as I did this morning) you can do the following:\necho 1 > /sys/block/<devnode>/device/delete\n\ne.g., in my case, /dev/sda had failed and I didn't want to reboot the server, so I did:\necho 1 > /sys/block/sda/device/delete\n\nAfter I did that, the new drive (which had actually been physically added already) was immediately visible.\nIf it is not visible at this point, you can also do this to force a re-scan:\necho \"- - -\" > /sys/class/scsi_host/host<n>/scan\n\nThat \"- - -\" is wildcards for channel, id & LUN respectively, so you can restrict the scan to some subset if you want by specifying numbers instead.\nBefore you start, you could also:\nreadlink /sys/block/<devnode>\n\nWhich will show you the path with the right host number to check in /proc/scsi/scsi for disappearence after removal.\n\n"
}