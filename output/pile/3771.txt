{
    "criteria": [
        {
            "criterion": "AllDocuments",
            "passed": true,
            "reason": "All documents pass."
        },
        {
            "criterion": "QuestionAnswerStringsV2",
            "passed": true,
            "reason": "Text contains ['Q:', 'A:']."
        },
        {
            "criterion": "FullyStructured",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStrings",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesStringsV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ListPrefixV2",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesMinimalEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesSynonymsEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        },
        {
            "criterion": "ExamplesDiverseEmbed",
            "passed": false,
            "reason": "Does not meet criterion."
        }
    ],
    "doc_id": "3771",
    "text": "Q:\n\nProblema Funcion SQL Error: not allowed to return a result set from a function\n\nno veo para nada el problema de esta funci\u00f3n, intento validar el pin de un usuario, pero me sale este error, he estado mirando en otras preguntas pero no veo el problema.\nLes dejo el c\u00f3digo aqu\u00ed abajo:\nCREATE DEFINER=`root`@`localhost` FUNCTION `validar_pin`(id_usuario int, pin int) RETURNS BOOLEAN\nBEGIN\n    DECLARE pin_user int;\n    DECLARE fecha DATE;\n    select desbloqueo into fecha from Usuario where id = id_usuario;\n    if fecha = null then\n        SELECT pin into pin_user FROM Usuario where id_usuario = id;\n        if (pin = pin_user) THEN\n            UPDATE Usuario SET num_intentos = 0 WHERE id = id_usuario;\n            UPDATE Usuario SET desbloqueo = NULL WHERE id = id_usuario;\n            RETURN TRUE;\n        else\n            UPDATE Usuario SET num_intentos = (num_intentos + 1) WHERE id = id_usuario;\n        end if;\n    end if;\n    if (select num_intentos from Usuario where id = id_usuario) = 3 then\n        UPDATE Usuario SET desbloqueo = DATE_ADD(NOW(), INTERVAL 1 DAY) WHERE id = id_usuario;\n        select \"Has agotado todas las oportunidades, intentalo en 24h\";\n    end if;\n    RETURN FALSE;\nEND\n\nAlguna sugerencia??\nGracias\n\nA:\n\nEl problema es que dentro de las funciones no puedes hacer un select sin decir en donde quieres guardar los datos por as\u00ed decirlo. \nO sea \u00e9sto estar\u00eda mal dentro de una funci\u00f3n:\nselect nombre from usuario;\n\nEn tu funci\u00f3n tienes varias partes en que haces un select y no insertas el valor, por ejemplo ac\u00e1:\nif (select num_intentos from Usuario where id = id_usuario) = 3 then\n\nDeber\u00edas primero obtener ese numero y guardarlo en una variable y luego es que preguntas por esa variable:\n select num_intentos into _num_intentos from Usuario where id = id_usuario\n if(_num_intentos = 3) then\n ....\n\nEn la documentaci\u00f3n lo indican (si es que usas mysql, asumo eso):\nprocedimientos y funciones\n\nStatements that return a result set can be used within a stored procedure but not within a stored function. This prohibition includes SELECT statements that do not have an INTO var_list clause and other statements\n\nDice las declaraciones que retornan un listado de resultados pueden ser usadas dentro de procedimientos almacenados pero no dentro de funciones almacenadas, esta prohibici\u00f3n incluye los SELECTS que no tengan una cla\u00fasula INTO a una variable y otras declaraciones.\n\n"
}